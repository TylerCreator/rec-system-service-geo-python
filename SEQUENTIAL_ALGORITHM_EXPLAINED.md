# ğŸ”® ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ - ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾Ğµ Ğ¾Ğ±ÑŠÑÑĞ½ĞµĞ½Ğ¸Ğµ

## ğŸ“‹ Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ

1. [ĞĞ±Ğ·Ğ¾Ñ€](#Ğ¾Ğ±Ğ·Ğ¾Ñ€)
2. [Ğ¨Ğ°Ğ³ 1: ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ compositionsDAG.json](#ÑˆĞ°Ğ³-1-Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ-compositionsdagjson)
3. [Ğ¨Ğ°Ğ³ 2: ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² NetworkX DiGraph](#ÑˆĞ°Ğ³-2-Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ-Ğ²-networkx-digraph)
4. [Ğ¨Ğ°Ğ³ 3: Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿ÑƒÑ‚ĞµĞ¹ Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¾Ğ±ÑƒÑ‡Ğ°ÑÑ‰Ğ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…](#ÑˆĞ°Ğ³-3-Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ-Ğ¿ÑƒÑ‚ĞµĞ¹-Ğ¸-ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ-Ğ¾Ğ±ÑƒÑ‡Ğ°ÑÑ‰Ğ¸Ñ…-Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)
5. [Ğ¨Ğ°Ğ³ 4: ĞšĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑƒĞ·Ğ»Ğ¾Ğ² (LabelEncoder)](#ÑˆĞ°Ğ³-4-ĞºĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ-ÑƒĞ·Ğ»Ğ¾Ğ²-labelencoder)
6. [Ğ¨Ğ°Ğ³ 5: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ PyTorch Geometric Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…](#ÑˆĞ°Ğ³-5-ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ-pytorch-geometric-Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)
7. [Ğ¨Ğ°Ğ³ 6: ĞĞ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ DAGNN Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸](#ÑˆĞ°Ğ³-6-Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ-dagnn-Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸)
8. [Ğ¨Ğ°Ğ³ 7: Inference (Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ğµ)](#ÑˆĞ°Ğ³-7-inference-Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ğµ)

---

## ĞĞ±Ğ·Ğ¾Ñ€

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¹ Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ/Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ Ğ² workflow Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ:
- Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¹ Ğ¸Ğ· Ğ‘Ğ”
- DAG ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ (Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ°Ñ†Ğ¸ĞºĞ»Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ³Ñ€Ğ°Ñ„)
- Graph Neural Network (DAGNN)

**Ğ’Ñ€ĞµĞ¼Ñ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ:** 2-5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
**Ğ’Ñ€ĞµĞ¼Ñ inference:** 10-50ms

### âš ï¸ Ğ’Ğ°Ğ¶Ğ½Ğ¾! ĞĞ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞ²ÑĞ·ĞµĞ¹ Ğ² DAG

Ğ’ ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¹ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‚ **Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ²Ğ° Ñ‚Ğ¸Ğ¿Ğ° ÑĞ²ÑĞ·ĞµĞ¹**:

```
âœ… Table â†’ Service
   Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‘Ñ‚ÑÑ ĞºĞ°Ğº Ğ²Ñ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ ÑĞµÑ€Ğ²Ğ¸ÑÑƒ
   ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: table_1001 â†’ service_123 (Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ "theme")

âœ… Service â†’ Service
   Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ ÑĞµÑ€Ğ²Ğ¸ÑĞ° Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‘Ñ‚ÑÑ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¼Ñƒ ÑĞµÑ€Ğ²Ğ¸ÑÑƒ
   ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: service_123 â†’ service_456 (Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ "file")

âŒ Service â†’ Table ĞĞ• Ğ¡Ğ£Ğ©Ğ•Ğ¡Ğ¢Ğ’Ğ£Ğ•Ğ¢!
   Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ĞĞ• Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ñ†ĞµĞ»ÑŒÑ ÑĞ²ÑĞ·Ğ¸
   Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ - Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Ğ²Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹)
```

**Ğ¢Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ workflow:**
```
table_A â†’ service_1 â†’ service_2
table_B â†’ service_2 â†’ service_3

Ğ³Ğ´Ğµ:
- table_A, table_B - Ğ²Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
- service_1, service_2, service_3 - Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ÑÑ‰Ğ¸Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹
- service_1 â†’ service_2 - Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ° Ğ¿Ñ€Ğ¾Ğ¼ĞµĞ¶ÑƒÑ‚Ğ¾Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°
```

---

## Ğ¨Ğ°Ğ³ 1: ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ compositionsDAG.json

### 1.1 Ğ’Ñ‹Ğ·Ğ¾Ğ² Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ recover_new()

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  await recover_new(db)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ²ÑĞµ Calls Ğ¸Ğ· Ğ‘Ğ”                   â”‚
â”‚     SELECT * FROM Calls ORDER BY id ASC         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ²Ñ…Ğ¾Ğ´Ñ‹/Ğ²Ñ‹Ñ…Ğ¾Ğ´Ñ‹ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ°     â”‚
â”‚     - call.input  (Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹)                   â”‚
â”‚     - call.result (Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ ÑĞ²ÑĞ·Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ¸ Ğ´Ğ°Ñ‚Ğ°ÑĞµÑ‚Ñ‹        â”‚
â”‚     - WIDGET_FILE: Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ñ‹Ğµ ÑĞ²ÑĞ·Ğ¸               â”‚
â”‚     - WIDGET_THEME_SELECT: Ğ´Ğ°Ñ‚Ğ°ÑĞµÑ‚Ñ‹             â”‚
â”‚     - WIDGET_EDIT: Ğ¿Ñ€Ğ¾Ğ¼ĞµĞ¶ÑƒÑ‚Ğ¾Ñ‡Ğ½Ñ‹Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Ğ¡Ñ‚Ñ€Ğ¾Ğ¸Ñ‚ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸ (workflows)               â”‚
â”‚     Composition = {                             â”‚
â”‚       "nodes": [service1, table1, service2],    â”‚
â”‚       "links": [                                â”‚
â”‚         {source: 0, target: 1},                 â”‚
â”‚         {source: 1, target: 2}                  â”‚
â”‚       ]                                         â”‚
â”‚     }                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ² app/static/compositionsDAG.json â”‚
â”‚     [                                           â”‚
â”‚       {nodes: [...], links: [...]},             â”‚
â”‚       {nodes: [...], links: [...]},             â”‚
â”‚       ...                                       â”‚
â”‚     ]                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ compositionsDAG.json

```json
[
  {
    "nodes": [
      {"id": "1002132", "mid": null},      // table_1002132
      {"id": 3985, "mid": 308},            // service_308
      {"id": 3986, "mid": 309}             // service_309
    ],
    "links": [
      {"source": "1002132", "target": 3985, "fields": "1002132:theme"},  // table â†’ service (input)
      {"source": 3985, "target": 3986, "fields": ["file:source"]}        // service â†’ service (result)
    ]
  },
  ...
]
```

**ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ:**
- `mid` != null - ÑÑ‚Ğ¾ ÑĞµÑ€Ğ²Ğ¸Ñ â†’ ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ² `service_{mid}`
- `mid` == null - ÑÑ‚Ğ¾ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° â†’ ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ² `table_{id}`

**Ğ’Ğ°Ğ¶Ğ½Ğ¾! ĞĞ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞ²ÑĞ·ĞµĞ¹:**
- âœ… **Table â†’ Service** - Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¿ĞµÑ€ĞµĞ´Ğ°ĞµÑ‚ÑÑ ĞºĞ°Ğº Ğ²Ñ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ ÑĞµÑ€Ğ²Ğ¸ÑÑƒ
- âœ… **Service â†’ Service** - Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ ÑĞµÑ€Ğ²Ğ¸ÑĞ° Ğ¿ĞµÑ€ĞµĞ´Ğ°ĞµÑ‚ÑÑ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¼Ñƒ
- âŒ **Service â†’ Table** - Ğ¢ĞĞšĞĞ“Ğ ĞĞ• Ğ‘Ğ«Ğ’ĞĞ•Ğ¢! (Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ½Ğµ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ñ†ĞµĞ»ÑŒÑ, Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ¼)

---

## Ğ¨Ğ°Ğ³ 2: ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² NetworkX DiGraph

### 2.1 Ğ—Ğ°Ñ‡ĞµĞ¼ Ğ½ÑƒĞ¶ĞµĞ½ NetworkX DiGraph?

```
compositionsDAG.json                NetworkX DiGraph
(ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¹)        â†’        (ĞµĞ´Ğ¸Ğ½Ñ‹Ğ¹ Ğ³Ñ€Ğ°Ñ„ ÑĞ¾ Ğ²ÑĞµĞ¼Ğ¸ ÑĞ²ÑĞ·ÑĞ¼Ğ¸)

[                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  {nodes: [...], links: [...]},     â”‚   service_123        â”‚
  {nodes: [...], links: [...]},  â†’  â”‚        â†“             â”‚
  ...                                â”‚   table_1002120      â”‚
]                                    â”‚        â†“             â”‚
                                     â”‚   service_456        â”‚
ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:                            â”‚        â†“             â”‚
- Ğ”ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑƒĞ·Ğ»Ğ¾Ğ²                 â”‚   table_1001211      â”‚
- Ğ˜Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ³Ñ€Ğ°Ñ„Ñ‹                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
- ĞĞµÑ‚ ĞµĞ´Ğ¸Ğ½Ğ¾Ğ¹ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹               
                                     ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:
                                     - Ğ•Ğ´Ğ¸Ğ½Ñ‹Ğ¹ Ğ³Ñ€Ğ°Ñ„
                                     - ĞĞµÑ‚ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
                                     - ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ñ‹ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ¿ÑƒÑ‚ĞµĞ¹
                                     - ĞĞ½Ğ°Ğ»Ğ¸Ğ· ÑĞ²ÑĞ·Ğ½Ğ¾ÑÑ‚Ğ¸
```

### 2.2 ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

```python
def _load_dag_from_json(self, json_path: Path) -> nx.DiGraph:
    # Ğ¨Ğ°Ğ³ 1: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ³Ñ€Ğ°Ñ„
    dag = nx.DiGraph()
    
    # Ğ¨Ğ°Ğ³ 2: Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸
    for composition in data:
        # Ğ¨Ğ°Ğ³ 2.1: ĞœĞ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ñ… ID â†’ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ¼ĞµĞ½Ğ°
        id_to_mid = {}
        for node in composition["nodes"]:
            if "mid" in node:
                # Ğ­Ñ‚Ğ¾ ÑĞµÑ€Ğ²Ğ¸Ñ
                id_to_mid[node["id"]] = f"service_{node['mid']}"
            else:
                # Ğ­Ñ‚Ğ¾ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°
                id_to_mid[node["id"]] = f"table_{node['id']}"
        
        # Ğ¨Ğ°Ğ³ 2.2: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ€Ñ‘Ğ±Ñ€Ğ°
        for link in composition["links"]:
            src = id_to_mid[link["source"]]  # ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ID
            tgt = id_to_mid[link["target"]]  # Ğ² Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¸Ğ¼Ñ
            
            # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒĞ·Ğ»Ñ‹ Ñ Ñ‚Ğ¸Ğ¿Ğ¾Ğ¼
            dag.add_node(src, type='service' if 'service' in src else 'table')
            dag.add_node(tgt, type='service' if 'service' in tgt else 'table')
            
            # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ±Ñ€Ğ¾
            dag.add_edge(src, tgt)
    
    return dag
```

### 2.3 Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

```
ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ 1:                         ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ 2:
node_1 (id=1001) â†’ node_2 (mid=123)   node_a (id=1002) â†’ node_b (mid=123)
                                      
ĞŸĞ¾ÑĞ»Ğµ ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ğ¸ ID:                 ĞŸĞ¾ÑĞ»Ğµ ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ğ¸ ID:
table_1001 â†’ service_123              table_1002 â†’ service_123

                    â†“ ĞĞ‘ĞªĞ•Ğ”Ğ˜ĞĞ•ĞĞ˜Ğ• â†“

           Ğ•Ğ´Ğ¸Ğ½Ñ‹Ğ¹ NetworkX DiGraph:
           
         table_1001    table_1002
                  â”‚        â”‚
                  â–¼        â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   service_123       â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         
NetworkX Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸:
- ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½ÑĞµÑ‚ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€ÑƒÑÑ‰Ğ¸ĞµÑÑ ÑƒĞ·Ğ»Ñ‹ (service_123 Ğ²ÑÑ‚Ñ€ĞµÑ‡Ğ°ĞµÑ‚ÑÑ Ğ´Ğ²Ğ°Ğ¶Ğ´Ñ‹)
- Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ²ÑĞµ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ€Ñ‘Ğ±Ñ€Ğ°
- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ ĞµĞ´Ğ¸Ğ½ÑƒÑ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ Ğ³Ñ€Ğ°Ñ„Ğ°
```

### 2.4 Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚

```python
dag.nodes()  # ['service_123', 'table_1001', 'table_1002', 'service_456', ...]
dag.edges()  # [('table_1001', 'service_123'), ('table_1002', 'service_123'), ('service_123', 'service_456'), ...]

# ĞĞ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ:
# table â†’ service  (Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° ĞºĞ°Ğº Ğ²Ñ…Ğ¾Ğ´)
# service â†’ service (Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‘Ñ‚ÑÑ Ğ´Ğ°Ğ»ÑŒÑˆĞµ)

# ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ:
dag.in_degree('table_1001')   # Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ²Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ñ… ÑĞ²ÑĞ·ĞµĞ¹
dag.out_degree('service_123')  # Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ñ… ÑĞ²ÑĞ·ĞµĞ¹
dag.successors('table_1001')  # Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ ÑƒĞ·Ğ»Ñ‹
nx.has_path(dag, 'table_1001', 'table_1002')  # Ğ•ÑÑ‚ÑŒ Ğ»Ğ¸ Ğ¿ÑƒÑ‚ÑŒ
```

---

## Ğ¨Ğ°Ğ³ 3: Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿ÑƒÑ‚ĞµĞ¹ Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¾Ğ±ÑƒÑ‡Ğ°ÑÑ‰Ğ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### 3.1 Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿ÑƒÑ‚ĞµĞ¹ Ğ¸Ğ· DAG

```
Ğ”Ğ°Ğ½Ğ¾: DAG Ğ³Ñ€Ğ°Ñ„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  A â†’ B â†’ C â†’ D                  â”‚
â”‚  A â†’ E â†’ F                      â”‚
â”‚  B â†’ G                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ğ¦ĞµĞ»ÑŒ: Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ÑŒ Ğ²ÑĞµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹Ğµ Ğ¿ÑƒÑ‚Ğ¸

ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼:
for each node in dag:
    if node.out_degree > 0:
        DFS Ğ¾Ñ‚ ÑÑ‚Ğ¾Ğ³Ğ¾ ÑƒĞ·Ğ»Ğ°
        
Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ - Ğ¿ÑƒÑ‚Ğ¸:
[
    [A, B, C, D],    # ĞŸÑƒÑ‚ÑŒ 1
    [A, B, G],       # ĞŸÑƒÑ‚ÑŒ 2
    [A, E, F],       # ĞŸÑƒÑ‚ÑŒ 3
    [B, C, D],       # ĞŸÑƒÑ‚ÑŒ 4
    [B, G],          # ĞŸÑƒÑ‚ÑŒ 5
    [E, F]           # ĞŸÑƒÑ‚ÑŒ 6
]
```

### 3.2 Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¾Ğ±ÑƒÑ‡Ğ°ÑÑ‰Ğ¸Ñ… Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğ¾Ğ²

```
Ğ˜Ğ· Ğ¿ÑƒÑ‚ĞµĞ¹ ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ¿Ğ°Ñ€Ñ‹ (ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ â†’ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ ÑƒĞ·ĞµĞ»)

ĞŸÑƒÑ‚ÑŒ: [table_1001, service_123, table_1002, service_456]

ĞĞ±ÑƒÑ‡Ğ°ÑÑ‰Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚              â†’  Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ ÑƒĞ·ĞµĞ»         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ (table_1001,)         â†’  service_123            â”‚
â”‚ (table_1001,          â†’  table_1002             â”‚
â”‚  service_123)                                   â”‚
â”‚ (table_1001,          â†’  service_456            â”‚
â”‚  service_123,                                   â”‚
â”‚  table_1002)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€: Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ ÑƒĞ·ĞµĞ» = service_*
(Ğ¼Ñ‹ Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹, Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ²Ğ»ÑÑÑ‚ÑÑ Ğ²Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸)

Ğ˜Ñ‚Ğ¾Ğ³Ğ¾:
X_raw = [
    (table_1001,),               # ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚: Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¸ Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹
    (table_1001, service_123),   # ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚: Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° + ÑĞµÑ€Ğ²Ğ¸Ñ
]
y_raw = [
    service_123,  # ĞŸĞ¾ÑĞ»Ğµ table_1001 Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ service_123
    service_456   # ĞŸĞ¾ÑĞ»Ğµ (table_1001, service_123) ÑĞ»ĞµĞ´ÑƒĞµÑ‚ service_456
]

**ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ workflow:**
- table_1001 â†’ service_123 (Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° ĞºĞ°Ğº Ğ²Ñ…Ğ¾Ğ´ Ğ´Ğ»Ñ ÑĞµÑ€Ğ²Ğ¸ÑĞ°)
- service_123 â†’ service_456 (Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ÑĞµÑ€Ğ²Ğ¸ÑĞ° Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‘Ñ‚ÑÑ Ğ´Ğ°Ğ»ÑŒÑˆĞµ)
- table_1002 â†’ service_456 (Ğ´Ñ€ÑƒĞ³Ğ°Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ñ‚Ğ¾Ğ¶Ğµ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‘Ñ‚ÑÑ service_456)

**Ğ’Ğ°Ğ¶Ğ½Ğ¾:** Ğ’ y_raw Ğ¼Ñ‹ Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Ñƒ Ñ‡Ñ‚Ğ¾:
  - Ğ¡ĞµÑ€Ğ²Ğ¸ÑÑ‹ - ÑÑ‚Ğ¾ Ñ‚Ğ¾, Ñ‡Ñ‚Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚/Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚
  - Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ - ÑÑ‚Ğ¾ Ğ²Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹, Ğ¾Ğ½Ğ¸ Ğ½Ğµ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ "ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¼ ÑˆĞ°Ğ³Ğ¾Ğ¼"
  - Ğ’ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸: "ĞŸĞ¾ÑĞ»Ğµ service_123, ĞºĞ°ĞºĞ¾Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ´Ğ°Ğ»ÑŒÑˆĞµ?"
```

### 3.3 ĞšĞ¾Ğ´

```python
def _create_training_data(self, paths: List[List[str]]) -> Tuple[List, List]:
    X_raw = []  # ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ñ‹
    y_raw = []  # Ğ¦ĞµĞ»ĞµĞ²Ñ‹Ğµ ÑƒĞ·Ğ»Ñ‹
    
    for path in paths:
        # Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸ Ğ² Ğ¿ÑƒÑ‚Ğ¸ (ĞºÑ€Ğ¾Ğ¼Ğµ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¹ Ğ¸ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¹)
        for i in range(1, len(path) - 1):
            context = tuple(path[:i])      # Ğ’ÑÑ‘ Ğ´Ğ¾ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸
            next_step = path[i]            # Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ
            
            # Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ ÑƒĞ·ĞµĞ» - ÑĞµÑ€Ğ²Ğ¸Ñ
            if next_step.startswith("service"):
                X_raw.append(context)
                y_raw.append(next_step)
    
    return X_raw, y_raw
```

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:**
```
X_raw: [(service_123,), (service_123, table_1001), ...]
y_raw: [service_456, table_1002, ...]
```

---

## Ğ¨Ğ°Ğ³ 4: ĞšĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑƒĞ·Ğ»Ğ¾Ğ² (LabelEncoder)

### 4.1 Ğ—Ğ°Ñ‡ĞµĞ¼ Ğ½ÑƒĞ¶ĞµĞ½ LabelEncoder?

```
ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: Neural Networks Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚ Ñ Ñ‡Ğ¸ÑĞ»Ğ°Ğ¼Ğ¸, Ğ½Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ°Ğ¼Ğ¸

Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ¾Ğ²Ñ‹Ğµ Ğ¸Ğ¼ĞµĞ½Ğ° ÑƒĞ·Ğ»Ğ¾Ğ²:              Ğ§Ğ¸ÑĞ»Ğ¾Ğ²Ñ‹Ğµ Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ service_123        â”‚   â†’  fit()  â”‚      0       â”‚
â”‚ table_1001         â”‚   â†’         â”‚      1       â”‚
â”‚ service_456        â”‚   â†’         â”‚      2       â”‚
â”‚ table_1002         â”‚   â†’         â”‚      3       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LabelEncoder ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ğ±Ğ¸ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğµ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ:
  string â†â†’ integer
```

### 4.2 ĞŸÑ€Ğ¾Ñ†ĞµÑÑ fit_transform

```python
# Ğ˜ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
node_list = ['service_123', 'table_1001', 'service_456', 'table_1002']

# Ğ¨Ğ°Ğ³ 1: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ encoder
node_encoder = LabelEncoder()

# Ğ¨Ğ°Ğ³ 2: fit_transform
node_ids = node_encoder.fit_transform(node_list)

# Ğ§Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸:
# fit():
#   - ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ²ÑĞµ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ: {'service_123', 'table_1001', ...}
#   - Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¸Ñ… (Ğ°Ğ»Ñ„Ğ°Ğ²Ğ¸Ñ‚Ğ½Ğ¾)
#   - ĞŸÑ€Ğ¸ÑĞ²Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹: 0, 1, 2, 3, ...
#   - Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸

# transform():
#   - Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ğ¸Ñ‰ĞµÑ‚ ĞµĞ³Ğ¾ Ğ¸Ğ½Ğ´ĞµĞºÑ
#   - Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¼Ğ°ÑÑĞ¸Ğ² Ğ¸Ğ½Ğ´ĞµĞºÑĞ¾Ğ²

# Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:
node_ids = [0, 1, 2, 3]  # numpy array
```

### 4.3 Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ node_map

```python
# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ¸ÑĞºĞ°
node_map = {node: idx for node, idx in zip(node_list, node_ids)}

# Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:
node_map = {
    'service_123': 0,
    'table_1001': 1,
    'service_456': 2,
    'table_1002': 3
}

# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:
idx = node_map['service_123']  # â†’ 0
idx = node_map['table_1001']   # â†’ 1
```

### 4.4 Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ ÑÑ…ĞµĞ¼Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 LabelEncoder Process                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Input (ÑÑ‚Ñ€Ğ¾ĞºĞ¸):
  ['service_123', 'table_1001', 'service_456', 'table_1002']
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  LabelEncoder   â”‚
  â”‚                 â”‚
  â”‚  fit():         â”‚
  â”‚   1. Unique     â”‚
  â”‚   2. Sort       â”‚
  â”‚   3. Assign IDs â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
Output (Ñ‡Ğ¸ÑĞ»Ğ°):
  [0, 1, 2, 3]
  
Mapping (ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½ Ğ² encoder):
  service_123 â†” 0
  table_1001  â†” 1
  service_456 â†” 2
  table_1002  â†” 3

ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ¾Ğµ Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (inverse_transform):
  [0, 1, 2, 3] â†’ ['service_123', 'table_1001', ...]
```

---

## Ğ¨Ğ°Ğ³ 5: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ PyTorch Geometric Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### 5.1 Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ PyTorch Geometric Data?

```
PyTorch Geometric - Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° Ğ´Ğ»Ñ Graph Neural Networks

Data Ğ¾Ğ±ÑŠĞµĞºÑ‚ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  data.x          # Node features    â”‚
â”‚  data.edge_index # Graph structure  â”‚
â”‚  data.y          # Labels (Ğ¾Ğ¿Ñ†.)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ node features (data.x)

```python
# Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑƒĞ·Ğ»Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ²ĞµĞºÑ‚Ğ¾Ñ€ Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ¾Ğ²
features = []
for node in node_list:
    if dag.nodes[node]['type'] == 'service':
        features.append([1, 0])  # One-hot: [is_service, is_table]
    else:
        features.append([0, 1])  # One-hot: [is_service, is_table]

# ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·ÑƒĞµĞ¼ Ğ² Ñ‚ĞµĞ½Ğ·Ğ¾Ñ€
x = torch.tensor(features, dtype=torch.float)
```

**Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:**
```
Ğ£Ğ·ĞµĞ»             Type      Feature Vector
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
service_123   â†’ service â†’ [1, 0]
table_1001    â†’ table   â†’ [0, 1]
service_456   â†’ service â†’ [1, 0]
table_1002    â†’ table   â†’ [0, 1]

Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğ¹ Ñ‚ĞµĞ½Ğ·Ğ¾Ñ€ x:
tensor([[1, 0],    â† service_123 (Ğ¸Ğ½Ğ´ĞµĞºÑ 0)
        [0, 1],    â† table_1001  (Ğ¸Ğ½Ğ´ĞµĞºÑ 1)
        [1, 0],    â† service_456 (Ğ¸Ğ½Ğ´ĞµĞºÑ 2)
        [0, 1]])   â† table_1002  (Ğ¸Ğ½Ğ´ĞµĞºÑ 3)

Shape: (4, 2)  # 4 ÑƒĞ·Ğ»Ğ°, 2 Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ° ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹
```

### 5.3 Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ edge_index (ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ³Ñ€Ğ°Ñ„Ğ°)

```python
# Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ±Ñ€Ğ° Ğ² DAG
edge_list = []
for u, v in dag.edges():
    src_idx = node_map[u]  # Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ°
    tgt_idx = node_map[v]  # Ğ˜Ğ½Ğ´ĞµĞºÑ Ñ†ĞµĞ»Ğ¸
    edge_list.append([src_idx, tgt_idx])

# ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·ÑƒĞµĞ¼ Ğ² Ñ‚ĞµĞ½Ğ·Ğ¾Ñ€ Ğ¸ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ğ½Ğ¸Ñ€ÑƒĞµĞ¼
edge_index = torch.tensor(edge_list, dtype=torch.long).t()
```

**Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:**
```
DAG edges (ÑÑ‚Ñ€Ğ¾ĞºĞ¾Ğ²Ñ‹Ğµ) - ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ«Ğ• Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ:
  table_1001  â†’ service_123  âœ… (Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° ĞºĞ°Ğº Ğ²Ñ…Ğ¾Ğ´ Ğ´Ğ»Ñ ÑĞµÑ€Ğ²Ğ¸ÑĞ°)
  service_123 â†’ service_456  âœ… (Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ÑĞµÑ€Ğ²Ğ¸ÑĞ° Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‘Ñ‚ÑÑ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¼Ñƒ)
  table_1002  â†’ service_456  âœ… (Ğ²Ñ‚Ğ¾Ñ€Ğ°Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° ĞºĞ°Ğº Ğ²Ñ…Ğ¾Ğ´)

ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· node_map:
  service_123: 0
  table_1001:  1
  service_456: 2
  table_1002:  3

Ğ Ñ‘Ğ±Ñ€Ğ° Ñ Ğ¸Ğ½Ğ´ĞµĞºÑĞ°Ğ¼Ğ¸:
  1 â†’ 0    (table_1001 â†’ service_123)
  0 â†’ 2    (service_123 â†’ service_456)
  3 â†’ 2    (table_1002 â†’ service_456)

edge_list:
  [[1, 0],
   [0, 2],
   [3, 2]]

edge_index (Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹):
  tensor([[1, 0, 3],    â† Source nodes
          [0, 2, 2]])   â† Target nodes

Shape: (2, 3)  # 2 Ñ€ÑĞ´Ğ° (src, tgt), 3 Ñ€ĞµĞ±Ñ€Ğ°

ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½?
PyTorch Geometric Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ [2, num_edges]:
  - Ğ ÑĞ´ 0: Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ²
  - Ğ ÑĞ´ 1: Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹ Ñ†ĞµĞ»ĞµĞ¹
```

### 5.4 Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ² Ğ¸ Ñ†ĞµĞ»ĞµĞ¹ Ğ´Ğ»Ñ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ

```python
# ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·ÑƒĞµĞ¼ X_raw Ğ¸ y_raw Ğ² Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹

X_raw = [
    (service_123,),
    (service_123, table_1001),
]

y_raw = [
    service_456,
    table_1002
]

# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ node_map Ğ´Ğ»Ñ ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ğ¸
contexts = torch.tensor([
    node_map[context[-1]]  # Ğ‘ĞµÑ€Ñ‘Ğ¼ ĞŸĞĞ¡Ğ›Ğ•Ğ”ĞĞ˜Ğ™ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°
    for context in X_raw
], dtype=torch.long)

targets = torch.tensor([
    node_map[y]
    for y in y_raw
], dtype=torch.long)
```

**Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:**
```
X_raw (ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ñ‹):                contexts (Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ (table_1001,)        â”‚  â†’       â”‚  1   â”‚  (Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ = table_1001)
â”‚ (table_1001,         â”‚  â†’       â”‚  0   â”‚  (Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ = service_123)
â”‚  service_123)        â”‚          â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”˜

y_raw (Ñ†ĞµĞ»Ğ¸):                     targets (Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ service_123          â”‚  â†’       â”‚  0   â”‚
â”‚ table_1002           â”‚  â†’       â”‚  3   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”˜

contexts: tensor([1, 0])  # Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ñ… ÑƒĞ·Ğ»Ğ¾Ğ² Ğ² ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°Ñ…
targets:  tensor([0, 3])  # Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹ Ñ†ĞµĞ»ĞµĞ²Ñ‹Ñ… ÑƒĞ·Ğ»Ğ¾Ğ²
```

### 5.5 Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğ¹ Data Ğ¾Ğ±ÑŠĞµĞºÑ‚

```python
from torch_geometric.data import Data

data_pyg = Data(
    x=x,              # Node features: (num_nodes, num_features)
    edge_index=edge_index  # Graph structure: (2, num_edges)
)

# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:
data_pyg.x.shape         # torch.Size([4, 2])  - 4 ÑƒĞ·Ğ»Ğ°, 2 Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ°
data_pyg.edge_index.shape # torch.Size([2, 3])  - 3 Ñ€ĞµĞ±Ñ€Ğ°
```

---

## Ğ¨Ğ°Ğ³ 6: ĞĞ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ DAGNN Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸

### 6.1 ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DAGNNRecommender Model                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Input: x (num_nodes, 2)  +  edge_index (2, num_edges)
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: Linear(2 â†’ 64)                 â”‚
â”‚          + BatchNorm                    â”‚
â”‚          + ReLU                         â”‚
â”‚          + Dropout(0.4)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ (num_nodes, 64)
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 2: Linear(64 â†’ 64)                â”‚
â”‚          + BatchNorm                    â”‚
â”‚          + ReLU                         â”‚
â”‚          + Residual Connection          â”‚
â”‚          + Dropout(0.4)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ (num_nodes, 64)
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 3: DAGNN(64, K=10)                â”‚
â”‚          Graph Propagation              â”‚
â”‚          + Attention Weights            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ (num_nodes, 64)
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 4: Linear(64 â†’ 32)                â”‚
â”‚          + BatchNorm                    â”‚
â”‚          + ReLU                         â”‚
â”‚          + Dropout(0.4)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ (num_nodes, 32)
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 5: Linear(32 â†’ num_nodes)         â”‚
â”‚          Output layer                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ (num_nodes, num_nodes)
                â–¼
Output: Predictions for each node
```

### 6.2 Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· ÑĞ»Ğ¾Ğ¸

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:** 4 ÑƒĞ·Ğ»Ğ°, 2 Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ°

#### Ğ’Ñ…Ğ¾Ğ´:
```
x: tensor([[1, 0],    # service_123
           [0, 1],    # table_1001
           [1, 0],    # service_456
           [0, 1]])   # table_1002
Shape: (4, 2)
```

#### Layer 1: Linear(2 â†’ 64)
```python
self.lin1 = nn.Linear(2, 64)

# ĞœĞ°Ñ‚ĞµĞ¼Ğ°Ñ‚Ğ¸ĞºĞ°:
out = x @ W^T + b
# Ğ³Ğ´Ğµ W: (64, 2), b: (64,)

# Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:
x = self.lin1(x)  # (4, 2) â†’ (4, 64)
x = self.bn1(x)   # BatchNorm Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·ÑƒĞµÑ‚ Ğ¿Ğ¾ Ğ±Ğ°Ñ‚Ñ‡Ñƒ
x = F.relu(x)     # ReLU: max(0, x)
x = F.dropout(x, 0.4)  # Ğ¡Ğ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ¾ Ğ·Ğ°Ğ½ÑƒĞ»ÑĞµÑ‚ 40% Ğ½ĞµĞ¹Ñ€Ğ¾Ğ½Ğ¾Ğ²

ĞŸĞ¾ÑĞ»Ğµ Layer 1:
tensor([[0.23, 0.45, 0.0, 0.89, ...],   # service_123 (64 Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ)
        [0.12, 0.0, 0.56, 0.34, ...],   # table_1001
        [0.67, 0.23, 0.12, 0.0, ...],   # service_456
        [0.0, 0.78, 0.23, 0.45, ...]])  # table_1002
Shape: (4, 64)
```

#### Layer 2: Linear(64 â†’ 64) + Residual
```python
identity = x  # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ´Ğ»Ñ residual connection

x = self.lin2(x)      # (4, 64) â†’ (4, 64)
x = self.bn2(x)       # BatchNorm
x = F.relu(x)         # ReLU
x = x + identity      # Residual: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğ¹ x
x = F.dropout(x, 0.4)

Residual Connection (Ğ¿Ğ¾Ñ‡ĞµĞ¼Ñƒ Ğ²Ğ°Ğ¶Ğ½Ğ¾):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   x    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜           â”‚
    â”‚                â”‚
    â–¼                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚ Linear â”‚           â”‚
â”‚  + BN  â”‚           â”‚
â”‚ + ReLU â”‚           â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜           â”‚
    â”‚                â”‚
    â””â”€â”€â”€â”€â”€â”€ + â—„â”€â”€â”€â”€â”€â”€â”˜
         (element-wise add)
    
ĞŸĞ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ Ğ¸Ğ·Ğ±ĞµĞ¶Ğ°Ñ‚ÑŒ vanishing gradient
```

#### Layer 3: DAGNN (Graph Propagation)

```python
self.dagnn = DAGNN(64, K=10, dropout=0.4)

# DAGNN - ÑÑ‚Ğ¾ APPNP (Approximate Personalized Propagation of Neural Predictions)
```

**Ğ§Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°ĞµÑ‚ DAGNN:**

```
Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ 0: xâ‚€ = x (Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ features)

Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ 1: xâ‚ = propagate(xâ‚€, edge_index)
  Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑƒĞ·Ğ»Ğ°: xâ‚[i] = Î£(xâ‚€[neighbors] * weights)
  
Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ 2: xâ‚‚ = propagate(xâ‚, edge_index)
  ...
  
Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ K: x_K = propagate(x_{K-1}, edge_index)

Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²Ñ‹Ñ…Ğ¾Ğ´:
  out = attention_weights[0] * xâ‚€ + 
        attention_weights[1] * xâ‚ + 
        ... + 
        attention_weights[K] * x_K
```

**Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ¾ (K=2):**

```
Ğ“Ñ€Ğ°Ñ„:
  0 â†’ 1 â†’ 2 â†’ 3

Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ 0 (Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğµ features):
  node_0: [0.5, 0.3, ...]
  node_1: [0.2, 0.7, ...]
  node_2: [0.8, 0.1, ...]
  node_3: [0.4, 0.6, ...]

Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ 1 (Ğ¿ĞµÑ€Ğ²Ğ°Ñ propagation):
  node_0: [0.5, 0.3, ...] (Ğ½ĞµÑ‚ Ğ²Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ñ…)
  node_1: avg([0.5, 0.3, ...]) = [0.5, 0.3, ...]  Ğ¾Ñ‚ node_0
  node_2: avg([0.2, 0.7, ...]) = [0.2, 0.7, ...]  Ğ¾Ñ‚ node_1
  node_3: avg([0.8, 0.1, ...]) = [0.8, 0.1, ...]  Ğ¾Ñ‚ node_2

Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ 2 (Ğ²Ñ‚Ğ¾Ñ€Ğ°Ñ propagation):
  node_0: [0.5, 0.3, ...]
  node_1: avg([0.5, 0.3, ...])
  node_2: avg([0.5, 0.3, ...])  â† Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚ node_0 Ğ´Ğ¾ÑˆĞ»Ğ°!
  node_3: avg([0.2, 0.7, ...])  â† Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚ node_1 Ğ´Ğ¾ÑˆĞ»Ğ°!

Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²Ñ‹Ñ…Ğ¾Ğ´ (Ğ²Ğ·Ğ²ĞµÑˆĞµĞ½Ğ½Ğ°Ñ ÑÑƒĞ¼Ğ¼Ğ°):
  out = 0.3 * xâ‚€ + 0.5 * xâ‚ + 0.2 * xâ‚‚
  (attention_weights Ğ¾Ğ±ÑƒÑ‡Ğ°ÑÑ‚ÑÑ!)
```

**Ğ—Ğ°Ñ‡ĞµĞ¼ ÑÑ‚Ğ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾:**
- Ğ£Ğ·Ğ»Ñ‹ "ÑƒĞ·Ğ½Ğ°ÑÑ‚" Ğ¾ ÑĞ¾ÑĞµĞ´ÑÑ…
- Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ñ€Ğ°ÑĞ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ Ğ¿Ğ¾ Ğ³Ñ€Ğ°Ñ„Ñƒ
- Ğ”Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ ÑƒĞ·Ğ»Ñ‹ Ğ²Ğ»Ğ¸ÑÑÑ‚ Ğ´Ñ€ÑƒĞ³ Ğ½Ğ° Ğ´Ñ€ÑƒĞ³Ğ°

#### Layer 4: Linear(64 â†’ 32)
```python
x = self.lin3(x)      # (4, 64) â†’ (4, 32)
x = self.bn3(x)       # BatchNorm
x = F.relu(x)         # ReLU
x = F.dropout(x, 0.4)

Ğ£Ğ¼ĞµĞ½ÑŒÑˆĞ°ĞµĞ¼ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ½Ğ¾ÑÑ‚ÑŒ Ğ´Ğ»Ñ Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ñ
```

#### Layer 5: Output Linear(32 â†’ num_nodes)
```python
x = self.lin_out(x)   # (4, 32) â†’ (4, 4)

# Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑƒĞ·Ğ»Ğ° Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¾Ğ² Ğ²Ğ¾ Ğ²ÑĞµ ÑƒĞ·Ğ»Ñ‹

Output (logits):
tensor([[-0.5,  2.1, -1.3,  0.8],   # service_123: Ğ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸ â†’ [table_1001, service_456, ...]
        [ 1.2, -0.3,  3.5, -0.8],   # table_1001: ...
        [-0.9,  0.7, -1.1,  2.9],   # service_456: ...
        [ 0.3, -1.5,  1.8, -0.4]])  # table_1002: ...

Shape: (4, 4)  # ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑƒĞ·ĞµĞ» â†’ Ğ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑƒĞ·Ğ»Ğ°
```

### 5.6 ĞŸĞ¾Ğ»Ğ½Ğ°Ñ ÑÑ…ĞµĞ¼Ğ° Ğ¿Ñ€ÑĞ¼Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ°

```
Input:
  x: (4, 2)
  edge_index: (2, 3)
  
     â†“ Linear(2â†’64) + BN + ReLU + Dropout
     
  (4, 64)
  
     â†“ Linear(64â†’64) + BN + ReLU + Residual + Dropout
     
  (4, 64)
  
     â†“ DAGNN(K=10) - Graph Propagation
     
  (4, 64)
  
     â†“ Linear(64â†’32) + BN + ReLU + Dropout
     
  (4, 32)
  
     â†“ Linear(32â†’4)
     
  (4, 4) â† Output logits

     â†“ Softmax (Ğ¿Ñ€Ğ¸ inference)
     
  (4, 4) â† Probabilities
```

---

## Ğ¨Ğ°Ğ³ 6.3: ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ

### 6.3.1 Loss Calculation

```python
# Forward pass
out = model(data_pyg.x, data_pyg.edge_index, training=True)
# out shape: (num_nodes, num_nodes)

# Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½ÑƒĞ¶Ğ½Ñ‹Ğµ ÑƒĞ·Ğ»Ñ‹ (Ğ¸Ğ· ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²)
out_selected = out[contexts]
# Ğ•ÑĞ»Ğ¸ contexts = [0, 1], Ñ‚Ğ¾ out_selected = [out[0], out[1]]

# Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ Cross Entropy Loss
loss = F.cross_entropy(out_selected, targets)
```

**Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ ÑÑ…ĞµĞ¼Ğ°:**

```
out (Ğ²ÑĞµ ÑƒĞ·Ğ»Ñ‹):
  [[logit_0_0, logit_0_1, logit_0_2, logit_0_3],   â† node_0
   [logit_1_0, logit_1_1, logit_1_2, logit_1_3],   â† node_1
   [logit_2_0, logit_2_1, logit_2_2, logit_2_3],   â† node_2
   [logit_3_0, logit_3_1, logit_3_2, logit_3_3]]   â† node_3

contexts = [1, 0]  # Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹ ÑƒĞ·Ğ»Ğ¾Ğ² Ğ¸Ğ· ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼

out[contexts]:
  [[logit_1_0, logit_1_1, logit_1_2, logit_1_3],   â† node_1 (table_1001)
   [logit_0_0, logit_0_1, logit_0_2, logit_0_3]]   â† node_0 (service_123)

targets = [0, 2]  # ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹: service_123 Ğ¸ service_456

Cross Entropy:
  loss = -log(softmax(out[1])[0]) +    # table_1001 â†’ service_123
         -log(softmax(out[0])[2])      # service_123 â†’ service_456
  
  Ğ¦ĞµĞ»ÑŒ: ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ loss
  â†’ ĞœĞ¾Ğ´ĞµĞ»ÑŒ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… ĞºĞ»Ğ°ÑÑĞ¾Ğ²
```

### 6.3.2 Backward Pass & Optimization

```python
# 1. ĞĞ±Ğ½ÑƒĞ»Ğ¸Ñ‚ÑŒ Ğ³Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚Ñ‹
optimizer.zero_grad()

# 2. Forward pass
out = model(data_pyg.x, data_pyg.edge_index, training=True)
loss = F.cross_entropy(out[contexts], targets)

# 3. Backward pass (Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ğµ Ğ³Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ²)
loss.backward()
# Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ âˆ‚loss/âˆ‚W Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ²ĞµÑĞ¾Ğ² W

# 4. Gradient clipping (Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ exploding gradients)
torch.nn.utils.clip_grad_norm_(model.parameters(), max_norm=1.0)

# 5. Update weights
optimizer.step()
# W_new = W_old - learning_rate * gradient
```

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ½Ğ° Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:**

```
ĞĞ±ÑƒÑ‡Ğ°ÑÑ‰Ğ°Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€ĞºĞ°:
  table_1001 â†’ service_123  (Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‘Ñ‚ÑÑ ÑĞµÑ€Ğ²Ğ¸ÑÑƒ)
  service_123 â†’ service_456 (Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ÑĞµÑ€Ğ²Ğ¸ÑĞ° Ğ¸Ğ´Ñ‘Ñ‚ Ğ´Ğ°Ğ»ÑŒÑˆĞµ)
  table_1002 â†’ service_456  (Ğ²Ñ‚Ğ¾Ñ€Ğ°Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ´Ğ»Ñ ÑĞµÑ€Ğ²Ğ¸ÑĞ°)

contexts = [1, 0, 3]  # Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹: table_1001, service_123, table_1002
targets  = [0, 2, 2]  # Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹: service_123, service_456, service_456

ĞœĞ¾Ğ´ĞµĞ»ÑŒ ÑƒÑ‡Ğ¸Ñ‚ÑÑ:
  "ĞŸĞ¾ÑĞ»Ğµ table_1001 Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ service_123"
  "ĞŸĞ¾ÑĞ»Ğµ service_123 Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ service_456"
  "ĞŸĞ¾ÑĞ»Ğµ table_1002 Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ service_456"
```

**Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ:**

```
Epoch 1:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Forward  â†’ Loss: 2.35                  â”‚
â”‚ Backward â†’ Gradients computed          â”‚
â”‚ Update   â†’ Weights updated             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ Weights improved
         
Epoch 2:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Forward  â†’ Loss: 1.89  âœ“ (lower!)     â”‚
â”‚ Backward â†’ Gradients computed          â”‚
â”‚ Update   â†’ Weights updated             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ Weights improved more
         
...

Epoch 200:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Forward  â†’ Loss: 0.15  âœ“âœ“âœ“ (converged)â”‚
â”‚ EARLY STOPPING (no improvement)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3.3 Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑĞ»Ğ¾Ñ

**Layer 1 (Linear + BN):**
```
ĞĞ±ÑƒÑ‡Ğ°ĞµĞ¼Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:
  W1: (64, 2)    - Ğ²ĞµÑĞ° linear ÑĞ»Ğ¾Ñ
  b1: (64,)      - bias linear ÑĞ»Ğ¾Ñ
  Î³1: (64,)      - scale BatchNorm
  Î²1: (64,)      - shift BatchNorm

Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: 64*2 + 64 + 64 + 64 = 320 Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²

Ğ§Ñ‚Ğ¾ ÑƒÑ‡Ğ¸Ñ‚ÑÑ:
  - ĞšĞ°ĞºĞ¸Ğµ ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ¾Ğ² [is_service, is_table] Ğ²Ğ°Ğ¶Ğ½Ñ‹
  - ĞšĞ°Ğº Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ 2D Ğ² 64D Ğ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ÑÑ‚Ğ²Ğ¾
```

**Layer 2 (Linear + Residual):**
```
ĞĞ±ÑƒÑ‡Ğ°ĞµĞ¼Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:
  W2: (64, 64)   - Ğ²ĞµÑĞ°
  b2: (64,)      - bias
  Î³2: (64,)      - BatchNorm scale
  Î²2: (64,)      - BatchNorm shift

Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: 64*64 + 64 + 64 + 64 = 4288 Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²

Ğ§Ñ‚Ğ¾ ÑƒÑ‡Ğ¸Ñ‚ÑÑ:
  - Ğ‘Ğ¾Ğ»ĞµĞµ ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ² 64D Ğ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ÑÑ‚Ğ²Ğµ
  - Residual Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ· Layer 1
```

**Layer 3 (DAGNN - Graph Propagation):**
```
ĞĞ±ÑƒÑ‡Ğ°ĞµĞ¼Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:
  attention_weights: (K+1,)  Ğ³Ğ´Ğµ K=10
  
Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: 11 Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²

Ğ§Ñ‚Ğ¾ ÑƒÑ‡Ğ¸Ñ‚ÑÑ:
  - Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ ÑƒĞ´ĞµĞ»ÑÑ‚ÑŒ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ propagation
  - att[0]: Ğ²ĞµÑ Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ñ… features
  - att[1]: Ğ²ĞµÑ Ğ¿Ğ¾ÑĞ»Ğµ 1 hop
  - att[2]: Ğ²ĞµÑ Ğ¿Ğ¾ÑĞ»Ğµ 2 hops
  - ...
  - att[10]: Ğ²ĞµÑ Ğ¿Ğ¾ÑĞ»Ğµ 10 hops
  
Softmax(att) Ğ³Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ ÑÑƒĞ¼Ğ¼Ğ° = 1
```

**DAGNN Propagation Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾:**

```
K = 10 Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹

Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ 0: xâ‚€ = current_features

Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ 1:
  for each node i:
    xâ‚[i] = Î£(xâ‚€[neighbor_j] * edge_weight[jâ†’i]) / degree[i]
    
  ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ´Ğ»Ñ node_1 (table_1001):
    neighbors = [node_0]  # service_123
    xâ‚[1] = xâ‚€[0] * 1.0 / 1 = xâ‚€[0]
    
  Ğ”Ğ»Ñ node_2 (service_456):
    neighbors = [node_1]
    xâ‚[2] = xâ‚€[1]

Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ 2:
  node_2 Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚ node_0 (Ñ‡ĞµÑ€ĞµĞ· node_1)
  xâ‚‚[2] = aggregate(xâ‚[1]) = aggregate(xâ‚€[0])
  
... Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°ĞµÑ‚ÑÑ K Ñ€Ğ°Ğ·

Ğ¤Ğ¸Ğ½Ğ°Ğ»:
  out = att[0]*xâ‚€ + att[1]*xâ‚ + ... + att[10]*xâ‚â‚€
  
ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑƒĞ·ĞµĞ» "Ğ²Ğ¸Ğ´Ğ¸Ñ‚" Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° Ñ€Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¸ Ğ´Ğ¾ K hops!
```

**Layer 4 (Dimension Reduction):**
```
ĞĞ±ÑƒÑ‡Ğ°ĞµĞ¼Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:
  W4: (32, 64)
  b4: (32,)
  Î³4, Î²4: BatchNorm

Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: 32*64 + 32 + 32 + 32 = 2144 Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²

Ğ§Ñ‚Ğ¾ ÑƒÑ‡Ğ¸Ñ‚ÑÑ:
  - Ğ¡Ğ¶Ğ°Ñ‚Ğ¸Ğµ 64D â†’ 32D (ÑƒĞ±Ğ¸Ñ€Ğ°ĞµÑ‚ ÑˆÑƒĞ¼)
  - Ğ’Ñ‹Ğ´ĞµĞ»ÑĞµÑ‚ Ğ½Ğ°Ğ¸Ğ±Ğ¾Ğ»ĞµĞµ Ğ²Ğ°Ğ¶Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ¸
```

**Layer 5 (Output):**
```
ĞĞ±ÑƒÑ‡Ğ°ĞµĞ¼Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:
  W_out: (num_nodes, 32)  # Ğ’ Ğ½Ğ°ÑˆĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğµ (4, 32)
  b_out: (num_nodes,)     # (4,)

Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: 4*32 + 4 = 132 Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²

Ğ§Ñ‚Ğ¾ ÑƒÑ‡Ğ¸Ñ‚ÑÑ:
  - Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾Ğ³Ğ¾ Ñ†ĞµĞ»ĞµĞ²Ğ¾Ğ³Ğ¾ ÑƒĞ·Ğ»Ğ°
  - ĞšĞ°ĞºĞ¸Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ² 32D Ğ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ÑÑ‚Ğ²Ğµ ÑƒĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ Ğ½Ğ° ÑÑ‚Ğ¾Ñ‚ ÑƒĞ·ĞµĞ»
```

### 6.3.4 Ğ˜Ñ‚Ğ¾Ğ³Ğ¾ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ² Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸

```
Layer 1:      320 Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²
Layer 2:    4,288 Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²
DAGNN:         11 Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²
Layer 4:    2,144 Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²
Layer 5:      132 Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Ğ˜Ğ¢ĞĞ“Ğ:     6,895 Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²

Ğ’ÑĞµ Ğ¾Ğ½Ğ¸ Ğ¾Ğ±ÑƒÑ‡Ğ°ÑÑ‚ÑÑ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ Ñ‡ĞµÑ€ĞµĞ· backpropagation!
```

### 6.3.5 ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ (200 ÑĞ¿Ğ¾Ñ…)

```
Epoch 1:
  Loss: 2.347
  Gradient: Large (Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ´Ğ°Ğ»ĞµĞºĞ° Ğ¾Ñ‚ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼ÑƒĞ¼Ğ°)
  Learning rate: 0.001
  Weight update: Ğ—Ğ½Ğ°Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹
  
Epoch 10:
  Loss: 1.523  âœ“
  Gradient: Medium
  Learning rate: 0.001 (Ğ½Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»ÑÑ)
  
Epoch 50:
  Loss: 0.823  âœ“âœ“
  Gradient: Small
  Learning rate: 0.0005  â† ReduceLROnPlateau ÑĞ½Ğ¸Ğ·Ğ¸Ğ»
  
Epoch 100:
  Loss: 0.234  âœ“âœ“âœ“
  Gradient: Very small
  Learning rate: 0.00025
  
Epoch 150:
  Loss: 0.152
  No improvement for 50 epochs
  â†’ EARLY STOPPING

ĞœĞ¾Ğ´ĞµĞ»ÑŒ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ°!
```

---

## Ğ¨Ğ°Ğ³ 7: Inference (Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ğµ)

### 7.1 ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ñ

```
Ğ”Ğ°Ğ½Ğ¾: sequence = [table_1001, service_123]
Ğ¦ĞµĞ»ÑŒ: ĞŸÑ€ĞµĞ´ÑĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ ÑƒĞ·ĞµĞ»

Ğ¨Ğ°Ğ³ 1: Ğ’Ğ·ÑÑ‚ÑŒ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ ÑƒĞ·ĞµĞ»
  last_node = 'service_123'
  last_idx = node_map['service_123'] = 0

Ğ¨Ğ°Ğ³ 2: Forward pass Ñ‡ĞµÑ€ĞµĞ· Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ
  model.eval()  # ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ dropout
  with torch.no_grad():  # ĞĞµ Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ÑÑ‚ÑŒ Ğ³Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚Ñ‹
      out = model(data_pyg.x, data_pyg.edge_index, training=False)
  
  out shape: (4, 4)
  out = [
    [logit_0_to_0, logit_0_to_1, logit_0_to_2, logit_0_to_3],
    [logit_1_to_0, logit_1_to_1, logit_1_to_2, logit_1_to_3],  â† Ğ½Ğ°Ğ¼ Ğ½ÑƒĞ¶Ğ½Ğ° ÑÑ‚Ğ° ÑÑ‚Ñ€Ğ¾ĞºĞ°!
    [logit_2_to_0, logit_2_to_1, logit_2_to_2, logit_2_to_3],
    [logit_3_to_0, logit_3_to_1, logit_3_to_2, logit_3_to_3]
  ]

Ğ¨Ğ°Ğ³ 3: Ğ’Ğ·ÑÑ‚ÑŒ Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ ÑƒĞ·Ğ»Ğ°
  node_scores = out[1]  # Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ° Ğ´Ğ»Ñ table_1001
  # tensor([-0.5, 0.3, 2.8, 0.9])

Ğ¨Ğ°Ğ³ 4: ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Softmax
  probs = F.softmax(node_scores, dim=0)
  # tensor([0.05, 0.11, 0.72, 0.12])
  #         â†‘     â†‘     â†‘     â†‘
  #      node_0 node_1 node_2 node_3

Ğ¨Ğ°Ğ³ 5: Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ Ğ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸
  top_indices = np.argsort(probs)[::-1]
  # [2, 3, 1, 0]  â† node_2 (service_456) Ğ½Ğ°Ğ¸Ğ±Ğ¾Ğ»ĞµĞµ Ğ²ĞµÑ€Ğ¾ÑÑ‚ĞµĞ½!

Ğ¨Ğ°Ğ³ 6: ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾ Ğ² Ğ¸Ğ¼ĞµĞ½Ğ°
  predictions = [
    reverse_node_map[2],  # service_456
    reverse_node_map[3],  # table_1002
    ...
  ]
```

### 7.2 Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€

```
DAG (ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ«Ğ• Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ):
  table_1001  â†’ service_123
  table_1002  â†’ service_456
  service_123 â†’ service_456
  service_456 â†’ service_789

ĞŸĞ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ: [table_1001, service_123]
ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ ÑƒĞ·ĞµĞ»: service_123 (Ğ¸Ğ½Ğ´ĞµĞºÑ 0)

Forward pass:
  out[0] = [
     0.3,   # service_123 â†’ service_123 (unlikely, Ğ¿ĞµÑ‚Ğ»Ñ)
    -0.5,   # service_123 â†’ table_1001  (IMPOSSIBLE! table Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ñ†ĞµĞ»ÑŒÑ)
     2.8,   # service_123 â†’ service_456 (LIKELY! âœ“)
     0.9,   # service_123 â†’ service_789 (possible, Ğ½Ğ¾ Ğ¼ĞµĞ½ĞµĞµ Ğ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾)
     ...
  ]

Softmax:
  probs = [0.11, 0.05, 0.72, 0.12, ...]
                         â†‘
                   service_456 (72% Ğ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ)

Top-5 predictions (Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹):
  1. service_456  (0.72) â† ĞœĞ¾Ğ´ĞµĞ»ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·Ğ°Ğ»Ğ°!
  2. service_789  (0.12)
  3. service_123  (0.11) (Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)
  4. ...
  
Note: table_1001 Ğ¸ÑĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ÑÑ Ğ¸Ğ· Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ğ¹ 
      (Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ½Ğµ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ñ†ĞµĞ»ÑŒÑ, Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ¼!)
```

---

## ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ Table-based Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°

### ĞÑ‚Ğ»Ğ¸Ñ‡Ğ¸Ñ Ğ¾Ñ‚ Service-based

```
Service-based:                    Table-based:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Sequence:            â”‚         â”‚ Sequence:            â”‚
â”‚ [s_123, s_456, s_789]â”‚         â”‚ [t_1001, t_1002]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                â”‚
         â–¼                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ĞŸÑ€ĞµĞ´ÑĞºĞ°Ğ·Ğ°Ñ‚ÑŒ:         â”‚         â”‚ ĞĞ°Ğ¹Ñ‚Ğ¸ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶Ğ¸Ğ¼Ñ‹Ğµ:    â”‚
â”‚ service_999          â”‚         â”‚ Ğ’ÑĞµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ¸Ğ·       â”‚
â”‚                      â”‚         â”‚ t_1002 Ñ‡ĞµÑ€ĞµĞ· Ğ»ÑĞ±Ñ‹Ğµ   â”‚
â”‚ Ğ£Ñ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚:           â”‚         â”‚ Ğ¿Ñ€Ğ¾Ğ¼ĞµĞ¶ÑƒÑ‚Ğ¾Ñ‡Ğ½Ñ‹Ğµ        â”‚
â”‚ - Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹     â”‚         â”‚ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ (ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞĞ¯ ÑÑ…ĞµĞ¼Ğ°):
t_1001 â†’ s_123 â†’ s_456
t_1002 â†’ s_456 â†’ s_789

s_789 Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚/ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ â†’ t_1003

Service sequence: [s_123, s_456]
  â†’ Predict: s_789

Table sequence: [t_1001, t_1002]
  â†’ ĞĞ½Ğ°Ğ»Ğ¸Ğ·:
    1. t_1002 Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ² s_456
    2. ĞŸĞ¾ÑĞ»Ğµ s_456 Ğ¸Ğ´Ñ‘Ñ‚ s_789
    3. s_789 ÑĞ²ÑĞ·Ğ°Ğ½ Ñ t_1003
  â†’ ĞĞ°Ğ¹Ñ‚Ğ¸: t_1003
  â†’ Distance: 1 (Ğ¾Ñ‚ t_1002 Ğ´Ğ¾ t_1003 - Ğ¾Ğ´Ğ¸Ğ½ table hop)
```

### ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶Ğ¸Ğ¼Ñ‹Ñ… Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†

```python
def _find_reachable_tables(start_table):
    """BFS Ğ¿Ğ¾ Ğ³Ñ€Ğ°Ñ„Ñƒ, ÑĞ¾Ğ±Ğ¸Ñ€Ğ°Ñ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹"""
    
    reachable = set()
    visited = set()
    queue = [start_table]
    
    while queue:
        current = queue.pop(0)
        visited.add(current)
        
        # Ğ¡Ğ¼Ğ¾Ñ‚Ñ€Ğ¸Ğ¼ Ğ²ÑĞµÑ… Ğ½Ğ°ÑĞ»ĞµĞ´Ğ½Ğ¸ĞºĞ¾Ğ²
        for successor in dag.successors(current):
            # Ğ•ÑĞ»Ğ¸ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° - Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ² Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
            if successor.startswith("table_"):
                reachable.add(successor)
            
            # ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ¸ÑĞº Ñ‡ĞµÑ€ĞµĞ· ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ñ‚Ğ¾Ğ¶Ğµ
            if successor not in visited:
                queue.append(successor)
    
    return reachable
```

**Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ¾:**

```
Start: table_1001

Ğ ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ DAG:
  table_1001 â†’ service_123
  service_123 â†’ service_456
  table_1002 â†’ service_456
  table_1003 â†’ service_789
  service_456 â†’ service_789

Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ 1:
  current = table_1001
  successors = [service_123]  # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ² service_123
  reachable = []              # service_123 Ğ½Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°, Ğ½Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼
  queue = [service_123]

Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ 2:
  current = service_123
  successors = [service_456]  # Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ¸Ğ´Ñ‘Ñ‚ Ğ² service_456
  reachable = []
  queue = [service_456]

Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ 3:
  current = service_456
  successors = [service_789]
  reachable = []
  queue = [service_789]

Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ 4:
  current = service_789
  successors = []  # ĞšĞ¾Ğ½ĞµÑ‡Ğ½Ñ‹Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ
  
  ĞĞ! ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ²ÑĞµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ² Ğ³Ñ€Ğ°Ñ„Ğµ:
    table_1002 â†’ service_456 (service_456 ÑƒĞ¶Ğµ Ğ¿Ğ¾ÑĞµÑ‰Ñ‘Ğ½)
    table_1003 â†’ service_789 (service_789 ÑƒĞ¶Ğµ Ğ¿Ğ¾ÑĞµÑ‰Ñ‘Ğ½)
  
  reachable = [table_1002, table_1003]  â† Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ´Ğ»Ñ Ğ¿Ğ¾ÑĞµÑ‰Ñ‘Ğ½Ğ½Ñ‹Ñ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²!

Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: [table_1002, table_1003]

ĞĞ±ÑŠÑÑĞ½ĞµĞ½Ğ¸Ğµ:
  ĞÑ‚ table_1001 Ğ¼Ñ‹ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¸ Ñ‡ĞµÑ€ĞµĞ· service_123 â†’ service_456 â†’ service_789
  Ğ­Ñ‚Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚/ÑĞ²ÑĞ·Ğ°Ğ½Ñ‹ Ñ table_1002 Ğ¸ table_1003
  Ğ—Ğ½Ğ°Ñ‡Ğ¸Ñ‚ table_1002 Ğ¸ table_1003 - Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹!
```

---

## ĞŸĞ¾Ğ»Ğ½Ğ°Ñ ÑÑ…ĞµĞ¼Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SEQUENTIAL RECOMMENDATION                 â”‚
â”‚                         FULL PIPELINE                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1ï¸âƒ£ Ğ¡Ğ‘ĞĞ  Ğ”ĞĞĞĞ«Ğ¥
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  PostgreSQL  â”‚
   â”‚    Calls     â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   recover_new(db)
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚compositionsDAG.  â”‚
   â”‚     json         â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2ï¸âƒ£ ĞŸĞĞ¡Ğ¢Ğ ĞĞ•ĞĞ˜Ğ• Ğ“Ğ ĞĞ¤Ğ
          â”‚
          â–¼
   _load_dag_from_json()
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  NetworkX DiGraphâ”‚
   â”‚  - nodes: 1247   â”‚
   â”‚  - edges: 3421   â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3ï¸âƒ£ Ğ¡ĞĞ—Ğ”ĞĞĞ˜Ğ• ĞĞ‘Ğ£Ğ§ĞĞ®Ğ©Ğ˜Ğ¥ Ğ”ĞĞĞĞ«Ğ¥
          â”‚
          â–¼
   _extract_paths()
          â”‚
          â–¼
   Paths: [[A,B,C], [D,E,F], ...]
          â”‚
          â–¼
   _create_training_data()
          â”‚
          â–¼
   X_raw: [(A,), (A,B), ...]
   y_raw: [C, D, ...]

4ï¸âƒ£ ĞšĞĞ”Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ•
          â”‚
          â–¼
   LabelEncoder.fit_transform()
          â”‚
          â–¼
   node_map: {node_name: index}
          â”‚
          â–¼
   contexts: tensor([0, 5, 12, ...])
   targets:  tensor([3, 8, 15, ...])

5ï¸âƒ£ Ğ¡ĞĞ—Ğ”ĞĞĞ˜Ğ• PYTORCH GEOMETRIC DATA
          â”‚
          â–¼
   Data(
     x = [[1,0], [0,1], ...],        # Node features
     edge_index = [[0,1,...],        # Graph structure
                   [1,2,...]]
   )

6ï¸âƒ£ ĞĞ‘Ğ£Ğ§Ğ•ĞĞ˜Ğ•
          â”‚
          â–¼
   for epoch in range(200):
     â”œâ”€ Forward pass
     â”œâ”€ Calculate loss
     â”œâ”€ Backward pass
     â”œâ”€ Update weights
     â””â”€ Check early stopping

7ï¸âƒ£ Ğ¡ĞĞ¥Ğ ĞĞĞ•ĞĞ˜Ğ•
          â”‚
          â–¼
   Save:
   - dagnn_model.pth      (Ğ²ĞµÑĞ° Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸)
   - dagnn_metadata.pkl   (node_map, DAG)

8ï¸âƒ£ INFERENCE
          â”‚
          â–¼
   Input: sequence = [123, 456]
          â”‚
          â–¼
   last_node_idx = node_map['service_456']
          â”‚
          â–¼
   out = model(x, edge_index)
   probs = softmax(out[last_node_idx])
          â”‚
          â–¼
   top_predictions = argsort(probs)[:n]
          â”‚
          â–¼
   Output: [service_789, service_321, ...]
```

---

## ĞœĞ°Ñ‚ĞµĞ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ñ‹

### Forward Pass

```
Input: x âˆˆ â„^(NÃ—2), edge_index âˆˆ â„¤^(2Ã—E)
Ğ³Ğ´Ğµ N = Ñ‡Ğ¸ÑĞ»Ğ¾ ÑƒĞ·Ğ»Ğ¾Ğ², E = Ñ‡Ğ¸ÑĞ»Ğ¾ Ñ€Ñ‘Ğ±ĞµÑ€

Layer 1:
  hâ‚ = ReLU(BN(xWâ‚áµ€ + bâ‚))
  hâ‚ âˆˆ â„^(NÃ—64)

Layer 2 (Ñ residual):
  hâ‚‚ = ReLU(BN(hâ‚Wâ‚‚áµ€ + bâ‚‚)) + hâ‚
  hâ‚‚ âˆˆ â„^(NÃ—64)

DAGNN Propagation:
  hâ‚€ = hâ‚‚
  
  for k = 1 to K:
    hâ‚– = Dâ»Â¹Ahâ‚–â‚‹â‚
    Ğ³Ğ´Ğµ A - adjacency matrix, D - degree matrix
  
  h_out = Î£â‚– Î±â‚–hâ‚–
  Ğ³Ğ´Ğµ Î± = softmax(att_weights)

Layer 4:
  hâ‚„ = ReLU(BN(h_outWâ‚„áµ€ + bâ‚„))
  hâ‚„ âˆˆ â„^(NÃ—32)

Layer 5 (output):
  Å· = hâ‚„W_outáµ€ + b_out
  Å· âˆˆ â„^(NÃ—N)

Loss:
  L = -Î£áµ¢ log(softmax(Å·áµ¢)[yáµ¢])
  Ğ³Ğ´Ğµ i Ğ¿Ñ€Ğ¾Ğ±ĞµĞ³Ğ°ĞµÑ‚ Ğ¿Ğ¾ training samples
```

### Backpropagation

```
Ğ“Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚Ñ‹ Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ÑÑÑ‚ÑÑ Ğ¾Ñ‚ output Ğº input:

âˆ‚L/âˆ‚W_out â† Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ÑÑ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¼
   â†“
âˆ‚L/âˆ‚Wâ‚„
   â†“
âˆ‚L/âˆ‚att_weights (DAGNN)
   â†“
âˆ‚L/âˆ‚Wâ‚‚
   â†“
âˆ‚L/âˆ‚Wâ‚ â† Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ÑÑ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¼

ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ²ĞµÑĞ¾Ğ²:
  W_new = W_old - lr * âˆ‚L/âˆ‚W

Ğ³Ğ´Ğµ lr = learning_rate (0.001 â†’ 0.0005 â†’ 0.00025)
```

---

## Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ: Services vs Tables Ñ€ĞµĞ¶Ğ¸Ğ¼Ñ‹

### Services Mode

```
Input: [service_123, service_456]

Algorithm:
  1. last_service = service_456
  2. model.predict(service_456)
  3. Filter: only service_* nodes
  4. Return: [service_789, service_321, ...]
  
Output: Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹
```

### Tables Mode

```
Input: [table_1001, table_1002]

Algorithm:
  1. last_table = table_1002
  2. reachable = find_reachable_tables(table_1002)
     â†’ [table_1003, table_1004, ...] (Ñ‡ĞµÑ€ĞµĞ· BFS)
  3. For each reachable_table:
       a. model.predict(last_table) â†’ model_score
       b. calculate_distance(last_table, reachable_table) â†’ distance
       c. get_frequency(reachable_table) â†’ frequency
       d. combined_score = 0.5*model + 0.3*distance + 0.2*freq
  4. Sort by combined_score
  5. Return top N
  
Output: Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ñ ÑƒÑ‡Ñ‘Ñ‚Ğ¾Ğ¼:
  - ML prediction
  - Ğ Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ² DAG
  - Ğ§Ğ°ÑÑ‚Ğ¾Ñ‚Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
```

---

## ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ Ñ‚Ñ€ÑĞºĞ¸

### 1. Batch Normalization
```
Ğ—Ğ°Ñ‡ĞµĞ¼: Ğ¡Ñ‚Ğ°Ğ±Ğ¸Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ
ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚:
  - ĞĞ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·ÑƒĞµÑ‚ Ğ²Ñ…Ğ¾Ğ´Ñ‹: (x - mean) / std
  - ĞĞ±ÑƒÑ‡Ğ°ĞµĞ¼Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Î³, Î² Ğ´Ğ»Ñ scaling/shifting
  - ĞŸĞ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ Ğ¸Ğ·Ğ±ĞµĞ¶Ğ°Ñ‚ÑŒ internal covariate shift
```

### 2. Dropout
```
Ğ—Ğ°Ñ‡ĞµĞ¼: ĞŸÑ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ overfitting
ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚:
  - Training: Ğ¡Ğ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ¾ Ğ·Ğ°Ğ½ÑƒĞ»ÑĞµÑ‚ 40% Ğ½ĞµĞ¹Ñ€Ğ¾Ğ½Ğ¾Ğ²
  - Inference: Ğ’ÑĞµ Ğ½ĞµĞ¹Ñ€Ğ¾Ğ½Ñ‹ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹, Ğ²Ñ‹Ñ…Ğ¾Ğ´Ñ‹ * (1-p)
  - Ğ—Ğ°ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑĞµÑ‚ÑŒ ÑƒÑ‡Ğ¸Ñ‚ÑŒ robustĞ½Ñ‹Ğµ features
```

### 3. Residual Connection
```
Ğ—Ğ°Ñ‡ĞµĞ¼: ĞŸĞ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ Ğ³Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚Ğ°Ğ¼ "Ñ‚ĞµÑ‡ÑŒ" Ğ½Ğ°Ğ·Ğ°Ğ´
ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚:
  out = F(x) + x
  - Ğ•ÑĞ»Ğ¸ F(x) ÑƒÑ‡Ğ¸Ñ‚ÑÑ Ğ¿Ğ»Ğ¾Ñ…Ğ¾, Ğ³Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚ Ğ²ÑÑ‘ Ñ€Ğ°Ğ²Ğ½Ğ¾ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ñ‡ĞµÑ€ĞµĞ· x
  - ĞŸĞ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ Ğ¾Ğ±ÑƒÑ‡Ğ°Ñ‚ÑŒ Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ¸Ğµ ÑĞµÑ‚Ğ¸
```

### 4. Gradient Clipping
```
Ğ—Ğ°Ñ‡ĞµĞ¼: ĞŸÑ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ exploding gradients
ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚:
  if ||gradient|| > max_norm:
      gradient = gradient * max_norm / ||gradient||
  - ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½ÑƒÑ Ğ½Ğ¾Ñ€Ğ¼Ñƒ Ğ³Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚Ğ°
  - max_norm = 1.0 Ğ² Ğ½Ğ°ÑˆĞµĞ¼ ÑĞ»ÑƒÑ‡Ğ°Ğµ
```

### 5. Early Stopping
```
Ğ—Ğ°Ñ‡ĞµĞ¼: ĞÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ³Ğ´Ğ° Ğ½ĞµÑ‚ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğ¹
ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚:
  if loss < best_loss:
      best_loss = loss
      patience_counter = 0
  else:
      patience_counter += 1
      if patience_counter >= 50:
          STOP  # 50 ÑĞ¿Ğ¾Ñ… Ğ±ĞµĞ· ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ
```

### 6. Learning Rate Scheduling
```
Ğ—Ğ°Ñ‡ĞµĞ¼: ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ¾ ÑƒĞ¼ĞµĞ½ÑŒÑˆĞ°ĞµÑ‚ learning rate
ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚:
  ReduceLROnPlateau:
    if loss Ğ½Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞ°ĞµÑ‚ÑÑ 20 ÑĞ¿Ğ¾Ñ…:
        lr = lr * 0.5
    
  0.001 â†’ 0.0005 â†’ 0.00025 â†’ ...
  
  ĞŸĞ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ fine-tune Ğ² ĞºĞ¾Ğ½Ñ†Ğµ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ
```

---

## Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°

```
Ğ’Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ:
  - Compositions: ~500-1000
  - Nodes: ~1000-2000
  - Edges: ~2000-5000
  - Training samples: ~1000-3000

ĞœĞ¾Ğ´ĞµĞ»ÑŒ:
  - ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹: ~7000
  - Ğ¡Ğ»Ğ¾Ğ¸: 5
  - Ğ¢Ğ¸Ğ¿Ñ‹: Linear, BatchNorm, DAGNN

ĞĞ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ:
  - Ğ­Ğ¿Ğ¾Ñ…Ğ¸: 50-200
  - Ğ’Ñ€ĞµĞ¼Ñ: 2-5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
  - Early stopping: Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ ~100-150 ÑĞ¿Ğ¾Ñ…

Inference:
  - Ğ’Ñ€ĞµĞ¼Ñ: 10-50ms
  - ĞŸĞ°Ğ¼ÑÑ‚ÑŒ: ~50MB (Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ² RAM)
```

---

## Ğ¡Ñ…ĞµĞ¼Ğ° Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DB    â”‚ Calls table
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚recover_new()â”‚ ĞĞ½Ğ°Ğ»Ğ¸Ğ· ÑĞ²ÑĞ·ĞµĞ¹
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚compositionsDAG.  â”‚ JSON file
â”‚     json         â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  nx.DiGraph()    â”‚ Ğ“Ñ€Ğ°Ñ„ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                     â”‚                     â”‚
      â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Extract  â”‚        â”‚ Label    â”‚        â”‚ Features â”‚
â”‚ Paths    â”‚        â”‚ Encoding â”‚        â”‚ Creation â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                   â”‚                    â”‚
     â–¼                   â–¼                    â–¼
  X_raw,y_raw      node_map: {}          x: [[1,0],
                   {strâ†’int}                  [0,1],
                                              ...]
     â”‚                   â”‚                    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ PyG Data    â”‚
                  â”‚ x + edges   â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   DAGNN     â”‚
                  â”‚  Training   â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚Save Model   â”‚
                  â”‚  .pth + .pklâ”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  Inference  â”‚
                  â”‚  Ready!     â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ—Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Graph Neural Networks Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° workflow Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ². ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹:

1. **DAG ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°** - ĞµĞ´Ğ¸Ğ½Ğ¾Ğµ Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ²ÑĞµÑ… ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¹
2. **LabelEncoder** - Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑƒĞ·Ğ»Ğ¾Ğ² Ğ² Ñ‡Ğ¸ÑĞ»Ğ°
3. **PyTorch Geometric** - ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ Ğ³Ñ€Ğ°Ñ„Ğ°Ğ¼Ğ¸
4. **DAGNN** - propagation Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ³Ñ€Ğ°Ñ„Ñƒ
5. **Two modes** - Services Ğ¸ Tables Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ´Ğ°Ñ‡

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: Ğ¢Ğ¾Ñ‡Ğ½Ñ‹Ğµ Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ñ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ³Ğ¾ ÑˆĞ°Ğ³Ğ° Ğ² workflow! ğŸ¯**

