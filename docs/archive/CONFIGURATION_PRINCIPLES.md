# üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞

## Single Source of Truth - –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `.env`

---

## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥

### –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ `.env`:

```
.env —Ñ–∞–π–ª (–µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã)
    ‚Üì
Environment variables –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
    ‚Üì
app/core/config.py (Settings –∫–ª–∞—Å—Å —Å Pydantic)
    ‚Üì
main.py —á–∏—Ç–∞–µ—Ç settings
    ‚Üì
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
```

### –ß—Ç–æ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:

**‚úÖ –í docker-compose.yml:**
```yaml
command: python main.py  # –ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```

**‚úÖ –í Dockerfile:**
```dockerfile
CMD ["python", "main.py"]  # –ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```

**‚úÖ –í .env:**
```bash
# –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–¥–µ—Å—å
PORT=8080
SSL_ENABLED=true
SSL_KEY_PATH=/certs/privkey.pem
SSL_CERT_PATH=/certs/fullchain.pem
NODE_LOCAL_PORT=6868
NODE_DOCKER_PORT=8080
```

**‚úÖ –í main.py:**
```python
# –ß–∏—Ç–∞–µ–º –∏–∑ settings (–∫–æ—Ç–æ—Ä—ã–µ –∏–∑ .env)
ssl_keyfile = settings.SSL_KEY_PATH if settings.SSL_ENABLED else None
ssl_certfile = settings.SSL_CERT_PATH if settings.SSL_ENABLED else None

uvicorn.run(
    "main:app",
    host="0.0.0.0",
    port=settings.PORT,
    ssl_keyfile=ssl_keyfile,
    ssl_certfile=ssl_certfile
)
```

---

## ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–∏–∑–±–µ–≥–∞—Ç—å)

### –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:

**‚ùå –ù–ï –¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫:**
```yaml
# –í docker-compose.yml
command: python -m uvicorn main:app --host 0.0.0.0 --port 8080 --ssl-keyfile /certs/privkey.pem
```

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**
1. üî¥ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–∏ –≤ .env, –∏ –≤ –∫–æ–º–∞–Ω–¥–µ)
2. üî¥ –¢—Ä—É–¥–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å (–Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö)
3. üî¥ –õ–µ–≥–∫–æ –æ—à–∏–±–∏—Ç—å—Å—è (—Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö)
4. üî¥ –ù–µ –≥–∏–±–∫–æ (–Ω–µ–ª—å–∑—è –ª–µ–≥–∫–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å HTTP/HTTPS)

---

## üí° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

### 1. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ - `.env` —Ñ–∞–π–ª–µ:
```bash
# –ú–µ–Ω—è–µ—Ç–µ –∑–¥–µ—Å—å
SSL_ENABLED=true
PORT=8080

# –ù–µ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å –≤ docker-compose.yml, Dockerfile –∏–ª–∏ –≥–¥–µ-—Ç–æ –µ—â–µ
```

### 2. –ì–∏–±–∫–æ—Å—Ç—å

```bash
# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ HTTP - –ø—Ä–æ—Å—Ç–æ –∏–∑–º–µ–Ω–∏—Ç–µ .env
SSL_ENABLED=false

# –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç
PORT=9000

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ - –∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç!
docker-compose restart app
```

### 3. –û–¥–∏–Ω–∞–∫–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –≤–µ–∑–¥–µ

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
python main.py

# –í Docker (docker-compose.yml)
python main.py

# –í production (docker-compose-v2.yml)
python main.py

# –í–µ–∑–¥–µ –æ–¥–∏–Ω–∞–∫–æ–≤–æ!
```

### 4. –£–º–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

`main.py` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç:
- –ï—Å—Ç—å –ª–∏ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç HTTPS
- –ù–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç HTTP
- –í–∫–ª—é—á–µ–Ω –ª–∏ DEBUG —Ä–µ–∂–∏–º ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç auto-reload
- –í—Å–µ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è!

---

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```
1. Docker Compose —á–∏—Ç–∞–µ—Ç .env —Ñ–∞–π–ª
   ‚Üì
2. –ü–µ—Ä–µ–¥–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞–∫ environment
   ‚Üì
3. Python –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è: python main.py
   ‚Üì
4. main.py –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç settings –∏–∑ app/core/config.py
   ‚Üì
5. Settings (Pydantic) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–∏—Ç–∞–µ—Ç environment variables
   ‚Üì
6. main.py –∏—Å–ø–æ–ª—å–∑—É–µ—Ç settings –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ uvicorn
   ‚Üì
7. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
```

### P—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSL:

```python
# –í app/core/config.py
class Settings(BaseSettings):
    SSL_ENABLED: bool = False
    SSL_KEY_PATH: Optional[str] = "/certs/privkey.pem"
    SSL_CERT_PATH: Optional[str] = "/certs/fullchain.pem"
    PORT: int = 8080

# –í main.py
if settings.SSL_ENABLED and os.path.exists(settings.SSL_KEY_PATH):
    # –ó–∞–ø—É—Å–∫ —Å SSL
    uvicorn.run(..., ssl_keyfile=settings.SSL_KEY_PATH, ...)
else:
    # –ó–∞–ø—É—Å–∫ –±–µ–∑ SSL
    uvicorn.run(...)
```

---

## üìù –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

- [x] ‚úÖ –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `.env` —Ñ–∞–π–ª–µ
- [x] ‚úÖ `main.py` —á–∏—Ç–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ `settings`
- [x] ‚úÖ `Dockerfile` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç–æ–π CMD: `python main.py`
- [x] ‚úÖ `docker-compose.yml` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç–æ–π command (–∏–ª–∏ –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç)
- [x] ‚úÖ –ù–µ—Ç –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
- [x] ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

## üéØ –û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å

**–î–∞, —Ç–µ–∫—É—â–∏–π Dockerfile –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:**
- ‚úÖ –° docker-compose version 2
- ‚úÖ –° docker-compose version 3.8
- ‚úÖ –° docker-compose version 3.x
- ‚úÖ –í–æ–æ–±—â–µ —Å –ª—é–±–æ–π –≤–µ—Ä—Å–∏–µ–π Docker Compose
- ‚úÖ –ò –¥–∞–∂–µ –±–µ–∑ docker-compose (—Å –æ–±—ã—á–Ω—ã–º `docker run`)

**–í–µ—Ä—Å–∏—è docker-compose –≤–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞:**
- –°–∏–Ω—Ç–∞–∫—Å–∏—Å docker-compose.yml —Ñ–∞–π–ª–∞
- –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (healthcheck, depends_on —Å condition, –∏ —Ç.–¥.)
- –ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ Dockerfile!

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –° docker-compose version 2 (production):
```bash
docker-compose -f docker-compose-v2.yml up -d --build
# Dockerfile —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑
# –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ .env
```

### –° docker-compose version 3.8 (–ª–æ–∫–∞–ª—å–Ω–æ):
```bash
docker-compose up -d --build
# –¢–æ—Ç –∂–µ Dockerfile
# –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ .env
```

### –ë–µ–∑ docker-compose (—á–∏—Å—Ç—ã–π Docker):
```bash
docker build -t rec-system .
docker run -p 6868:8080 --env-file .env rec-system
# –¢–æ—Ç –∂–µ Dockerfile
# –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ .env
```

---

## üí° –ò—Ç–æ–≥

**–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–¥–µ–∞–ª—å–Ω–∞:**
- ‚úÖ Dockerfile —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ)
- ‚úÖ –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `.env` (Single Source of Truth)
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –õ–µ–≥–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±–æ–π –≤–µ—Ä—Å–∏–µ–π Docker Compose

**–ù–µ –Ω—É–∂–Ω–æ –Ω–∏—á–µ–≥–æ –º–µ–Ω—è—Ç—å!** üéâ

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 9 –æ–∫—Ç—è–±—Ä—è 2025

