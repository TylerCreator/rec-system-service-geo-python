# üîå –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Ä—Ç–∞—Ö

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ—Ä—Ç—ã –≤ Docker

Docker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–º–∞–ø–ø–∏–Ω–≥ –ø–æ—Ä—Ç–æ–≤** –¥–ª—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ö–æ—Å—Ç–æ–º –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º:

```
HOST_PORT:CONTAINER_PORT
–í–Ω–µ—à–Ω–∏–π:–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π
```

---

## üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ä—Ç–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (FastAPI):

```bash
NODE_LOCAL_PORT=6868       # –í–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç (–¥–æ—Å—Ç—É–ø —Å —Ö–æ—Å—Ç–∞)
NODE_DOCKER_PORT=8080      # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç (–≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
```

**–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ Docker —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç `8080`
- –°–Ω–∞—Ä—É–∂–∏ (—Å –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞) –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É `6868`
- –î–æ—Å—Ç—É–ø: `http://localhost:6868`

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL):

```bash
POSTGRESDB_LOCAL_PORT=5431      # –í–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç (–¥–æ—Å—Ç—É–ø —Å —Ö–æ—Å—Ç–∞)
POSTGRESDB_DOCKER_PORT=5432     # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç (–≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
```

**–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- PostgreSQL –≤–Ω—É—Ç—Ä–∏ Docker —Å–ª—É—à–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç `5432`
- –°–Ω–∞—Ä—É–∂–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É `5431` (—á—Ç–æ–±—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –ª–æ–∫–∞–ª—å–Ω—ã–º PostgreSQL)
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å —Ö–æ—Å—Ç–∞: `localhost:5431`

---

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (docker-compose.yml):

**`.env` –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
```bash
NODE_LOCAL_PORT=6868
NODE_DOCKER_PORT=8080
POSTGRESDB_LOCAL_PORT=5431
POSTGRESDB_DOCKER_PORT=5432
```

**–ó–∞–ø—É—Å–∫:**
```bash
docker-compose up -d
```

**–î–æ—Å—Ç—É–ø:**
- API: http://localhost:6868
- Swagger: http://localhost:6868/docs
- PostgreSQL: localhost:5431

### Production —Å–µ—Ä–≤–µ—Ä (docker-compose-v2.yml):

**`.env` –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Å –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π):**
```bash
NODE_LOCAL_PORT=6868        # –í–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
NODE_DOCKER_PORT=8080       # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç
POSTGRESDB_LOCAL_PORT=5432
POSTGRESDB_DOCKER_PORT=5432
```

**–ó–∞–ø—É—Å–∫:**
```bash
docker-compose -f docker-compose-v2.yml up -d
```

**–î–æ—Å—Ç—É–ø:**
- API: https://geos.icc.ru:6868 (–ø–æ—Ä—Ç 6868 —Å SSL)
- PostgreSQL: —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Docker —Å–µ—Ç–∏

---

## üîç –ü–æ—á–µ–º—É –ø–æ—Ä—Ç—ã –æ—Ç–ª–∏—á–∞—é—Ç—Å—è?

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤:

1. **–ò–∑–±–µ–∂–∞–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤:**
   - –ï—Å–ª–∏ –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ —É–∂–µ –∑–∞–ø—É—â–µ–Ω PostgreSQL –Ω–∞ –ø–æ—Ä—Ç—É 5432
   - Docker PostgreSQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 5431 —Å–Ω–∞—Ä—É–∂–∏, –Ω–µ –±—É–¥–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞

2. **–ó–∞–ø—É—Å–∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤:**
   - –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ Docker –ø—Ä–æ–µ–∫—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
   - –ö–∞–∂–¥—ã–π –Ω–∞ —Å–≤–æ–µ–º –≤–Ω–µ—à–Ω–µ–º –ø–æ—Ä—Ç—É

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - –ù–∞ production –º–æ–∂–Ω–æ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Ä—É–∂—É
   - –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ HTTPS (443) –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

4. **–ì–∏–±–∫–æ—Å—Ç—å:**
   - –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–æ—Ä—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ (8080, 5432)
   - –í–Ω–µ—à–Ω–∏–µ –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –ø–æ–¥ –≤–∞—à–∏ –Ω—É–∂–¥—ã

---

## üìù –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç—ã?

### –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env`:
```bash
# –ï—Å–ª–∏ –ø–æ—Ä—Ç 6868 –∑–∞–Ω—è—Ç, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π
NODE_LOCAL_PORT=7070        # –í–∞—à —Å–≤–æ–±–æ–¥–Ω—ã–π –ø–æ—Ä—Ç
NODE_DOCKER_PORT=8080       # –ù–µ –º–µ–Ω—è–π—Ç–µ (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π)

# –ï—Å–ª–∏ –ø–æ—Ä—Ç 5431 –∑–∞–Ω—è—Ç
POSTGRESDB_LOCAL_PORT=5433  # –í–∞—à —Å–≤–æ–±–æ–¥–Ω—ã–π –ø–æ—Ä—Ç
POSTGRESDB_DOCKER_PORT=5432 # –ù–µ –º–µ–Ω—è–π—Ç–µ (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π)
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
docker-compose down
docker-compose up -d
```

### –î–ª—è production —Å–µ—Ä–≤–µ—Ä–∞:

–û–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π HTTPS –ø–æ—Ä—Ç:
```bash
NODE_LOCAL_PORT=443         # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π HTTPS
NODE_DOCKER_PORT=8080       # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π
```

---

## üõ†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤

### –£–∑–Ω–∞—Ç—å –∫–∞–∫–∏–µ –ø–æ—Ä—Ç—ã –∑–∞–Ω—è—Ç—ã:

**Linux/Mac:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–æ—Ä—Ç
lsof -i :6868

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Å–ª—É—à–∞—é—â–∏–µ –ø–æ—Ä—Ç—ã
netstat -tlnp | grep LISTEN
```

**Windows:**
```bash
netstat -ano | findstr :6868
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –ø–æ—Ä—Ç–æ–≤ Docker:

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Ä—Ç—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –ò–ª–∏
docker ps

# –î–µ—Ç–∞–ª—å–Ω–æ –æ –ø–æ—Ä—Ç–∞—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker port <container_name>
```

---

## üîÑ –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã

### –ó–∞–ø—Ä–æ—Å –∫ API:

```
–í–∞—à –±—Ä–∞—É–∑–µ—Ä
    ‚Üì
http://localhost:6868/docs
    ‚Üì
Docker –º–∞–ø–ø–∏–Ω–≥ (6868 ‚Üí 8080)
    ‚Üì
FastAPI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–ø–æ—Ä—Ç 8080)
    ‚Üì
–û—Ç–≤–µ—Ç
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î:

```
Python –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–ª–æ–∫–∞–ª—å–Ω–æ)
    ‚Üì
postgresql://localhost:5431/rec_system
    ‚Üì
Docker –º–∞–ø–ø–∏–Ω–≥ (5431 ‚Üí 5432)
    ‚Üì
PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–ø–æ—Ä—Ç 5432)
    ‚Üì
–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```

### –í–Ω—É—Ç—Ä–∏ Docker (–º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏):

```
FastAPI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    ‚Üì
postgresql://postgresdb:5432/rec_system
    ‚Üì
PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    ‚Üì
–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–º—è —Å–µ—Ä–≤–∏—Å–∞ (postgresdb) –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç (5432)
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å

1. **–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–æ—Ä—Ç—ã (–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ):**
   - –û–±—ã—á–Ω–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ: 8080, 5432, 80, 443
   - –ù–µ –º–µ–Ω—è–π—Ç–µ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

2. **–í–Ω–µ—à–Ω–∏–µ –ø–æ—Ä—Ç—ã (–Ω–∞ —Ö–æ—Å—Ç–µ):**
   - –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã –Ω–∞ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ

3. **–í docker-compose.yml:**
   ```yaml
   ports:
     - "${NODE_LOCAL_PORT}:${NODE_DOCKER_PORT}"
   # –§–æ—Ä–º–∞—Ç: –í–ù–ï–®–ù–ò–ô:–í–ù–£–¢–†–ï–ù–ù–ò–ô
   ```

4. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:**
   ```yaml
   environment:
     - PORT=${NODE_DOCKER_PORT}  # –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç!
   ```

---

## üéì –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è 1: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–ø–æ—Ä—Ç—ã –æ—Ç–ª–∏—á–∞—é—Ç—Å—è)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

```bash
# .env
NODE_LOCAL_PORT=6868
NODE_DOCKER_PORT=8080
POSTGRESDB_LOCAL_PORT=5431
POSTGRESDB_DOCKER_PORT=5432
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è 2: Production (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–æ—Ä—Ç—ã –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ production

```bash
# .env (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –∏ production)
NODE_LOCAL_PORT=6868        # –û–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç
NODE_DOCKER_PORT=8080       # –û–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç
POSTGRESDB_LOCAL_PORT=5431
POSTGRESDB_DOCKER_PORT=5432
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è 3: –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–µ–∫—Ç–æ–≤

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

```bash
# –ü—Ä–æ–µ–∫—Ç 1
NODE_LOCAL_PORT=6868
POSTGRESDB_LOCAL_PORT=5431

# –ü—Ä–æ–µ–∫—Ç 2
NODE_LOCAL_PORT=6869
POSTGRESDB_LOCAL_PORT=5433

# –ü—Ä–æ–µ–∫—Ç 3
NODE_LOCAL_PORT=6870
POSTGRESDB_LOCAL_PORT=5435
```

---

## üìû Troubleshooting

### –û—à–∏–±–∫–∞: "Port already in use"

```bash
# 1. –ù–∞–π—Ç–∏ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç
lsof -i :6868  # Mac/Linux
netstat -ano | findstr :6868  # Windows

# 2. –õ–∏–±–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å, –ª–∏–±–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç –≤ .env
NODE_LOCAL_PORT=7070

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Docker
docker-compose down
docker-compose up -d
```

### –ù–µ –º–æ–≥—É –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ API

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω
docker-compose ps

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs app

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—Ç—ã
docker ps

# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –∞–¥—Ä–µ—Å
curl http://localhost:6868/
curl http://0.0.0.0:6868/
curl http://127.0.0.1:6868/
```

---

**–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ (–æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –∏ production):**

- üåê **API:** localhost:6868 ‚Üí container:8080 (–ª–æ–∫–∞–ª—å–Ω–æ) / geos.icc.ru:6868 ‚Üí container:8080 (production)
- üóÑÔ∏è **PostgreSQL:** localhost:5431 ‚Üí container:5432
- üìñ **Swagger UI:** http://localhost:6868/docs (–ª–æ–∫–∞–ª—å–Ω–æ) / https://geos.icc.ru:6868/docs (production)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 9 –æ–∫—Ç—è–±—Ä—è 2025

