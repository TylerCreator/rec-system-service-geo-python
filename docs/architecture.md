# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–¥–∞

–û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–¥–∞ –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ app/services/

```
app/services/
‚îú‚îÄ‚îÄ __init__.py                 # –≠–∫—Å–ø–æ—Ä—Ç—ã –º–æ–¥—É–ª–µ–π
‚îú‚îÄ‚îÄ calls_service.py            # –†–∞–±–æ—Ç–∞ —Å –≤—ã–∑–æ–≤–∞–º–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
‚îú‚îÄ‚îÄ compositions_service.py     # Wrapper –¥–ª—è compositions –º–æ–¥—É–ª–µ–π
‚îú‚îÄ‚îÄ datasets_service.py         # –†–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞—Å–µ—Ç–∞–º–∏  
‚îú‚îÄ‚îÄ services_service.py         # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ update_service.py           # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
‚îÇ
‚îú‚îÄ‚îÄ compositions/               # –ú–æ–¥—É–ª–∏ –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ü–∏–π (—Ä–∞–∑–±–∏—Ç –±–æ–ª—å—à–æ–π —Ñ–∞–π–ª)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ builder.py             # –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–∑–∏—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ helpers.py             # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ recovery.py            # –ê–ª–≥–æ—Ä–∏—Ç–º—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ repository.py          # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ service_map.py         # –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã —Å–≤—è–∑–µ–π —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ
‚îî‚îÄ‚îÄ utils/                      # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã (—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è)
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ constants.py           # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
    ‚îú‚îÄ‚îÄ parsers.py             # –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö
    ‚îî‚îÄ‚îÄ validators.py          # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
```

## –ú–æ–¥—É–ª–∏

### utils/ - –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã

#### constants.py
–•—Ä–∞–Ω–∏—Ç –≤—Å–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
- `DATASET_ID_OFFSET` - —Å–º–µ—â–µ–Ω–∏–µ ID –¥–∞—Ç–∞—Å–µ—Ç–æ–≤
- `WIDGET_*` - —Ç–∏–ø—ã –≤–∏–¥–∂–µ—Ç–æ–≤
- `TASK_*` - —Å—Ç–∞—Ç—É—Å—ã –∑–∞–¥–∞—á

```python
from app.services.utils.constants import WIDGET_FILE, TASK_SUCCEEDED
```

#### parsers.py
–§—É–Ω–∫—Ü–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö:
- `safe_json_parse()` - –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ JSON
- `parse_datetime()` - –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç
- `parse_service_params()` - –ø–∞—Ä—Å–∏–Ω–≥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–µ—Ä–≤–∏—Å–æ–≤
- `to_string()` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ —Å—Ç—Ä–æ–∫—É

```python
from app.services.utils.parsers import safe_json_parse, parse_datetime
```

#### validators.py
–§—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
- `is_hashable()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ö–µ—à–∏—Ä—É–µ–º–æ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è
- `categorize_params()` - –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

```python
from app.services.utils.validators import is_hashable
```

### compositions/ - –ú–æ–¥—É–ª–∏ –∫–æ–º–ø–æ–∑–∏—Ü–∏–π

–ë–æ–ª—å—à–æ–π —Ñ–∞–π–ª `compositions_service.py` (905 —Å—Ç—Ä–æ–∫) —Ä–∞–∑–±–∏—Ç –Ω–∞ 5 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π:

#### service_map.py
–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã —Å–≤—è–∑–µ–π —Å–µ—Ä–≤–∏—Å–æ–≤:
- `build_service_connection_map()` - –∫–∞—Ä—Ç–∞ –≤—Ö–æ–¥–æ–≤/–≤—ã—Ö–æ–¥–æ–≤ —Å–µ—Ä–≤–∏—Å–æ–≤
- `build_dataset_guid_map()` - –º–∞–ø–ø–∏–Ω–≥ GUID ‚Üí ID –¥–∞—Ç–∞—Å–µ—Ç–æ–≤

#### helpers.py
–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- `normalize_dataset_id()` - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è ID –¥–∞—Ç–∞—Å–µ—Ç–∞
- `add_task_link()` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏
- `create_composition_node()` - —Å–æ–∑–¥–∞–Ω–∏–µ —É–∑–ª–∞ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏

#### builder.py
–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–π:
- `build_composition_for_task()` - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è –∑–∞–¥–∞—á–∏
- `normalize_composition()` - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è (–ª–æ–∫–∞–ª—å–Ω—ã–µ ID, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞)

#### recovery.py
–ê–ª–≥–æ—Ä–∏—Ç–º—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:
- `recover()` - –±–∞–∑–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- `recover_new()` - —É–ª—É—á—à–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å –¥–∞—Ç–∞—Å–µ—Ç–∞–º–∏
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏: `_is_successful_with_wms()`, `_process_task_inputs()`, `_register_task_outputs()`

#### repository.py
–û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö:
- `create_compositions()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–π
- `create_users()` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `fetch_all_compositions()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–∑–∏—Ü–∏–π
- `get_composition_stats()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–ø–æ–∑–∏—Ü–∏–π

## –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

### 1. DRY (Don't Repeat Yourself)

**–ë—ã–ª–æ:** –§—É–Ω–∫—Ü–∏–∏ `parse_datetime`, `to_string`, `safe_json_parse` –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∏—Å—å –≤ 3 —Ñ–∞–π–ª–∞—Ö
**–°—Ç–∞–ª–æ:** –û–¥–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ `utils/parsers.py`

### 2. Single Responsibility Principle

**–ë—ã–ª–æ:** `compositions_service.py` - 905 —Å—Ç—Ä–æ–∫, –º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π
**–°—Ç–∞–ª–æ:** 5 –º–æ–¥—É–ª–µ–π, –∫–∞–∂–¥—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é –æ–±–ª–∞—Å—Ç—å

### 3. –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å

–ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –º–æ–∂–µ—Ç –±—ã—Ç—å:
- –õ–µ–≥–∫–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –æ—Ç–¥–µ–ª—å–Ω–æ
- –ò–∑–º–µ–Ω–µ–Ω –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –¥—Ä—É–≥–∏–µ
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤ –¥—Ä—É–≥–∏—Ö —á–∞—Å—Ç—è—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 4. –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

`compositions_service.py` –æ—Å—Ç–∞–ª—Å—è –∫–∞–∫ wrapper, –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç:

```python
# –°—Ç–∞—Ä—ã–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
from app.services.compositions_service import recover

# –ù–æ–≤—ã–π –∫–æ–¥ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥–º–æ–¥—É–ª–∏
from app.services.compositions.recovery import recover
```

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–æ–¥—É–ª–µ–π

```
compositions_service.py (wrapper)
    ‚îî‚îÄ‚îÄ compositions/
        ‚îú‚îÄ‚îÄ recovery.py
        ‚îÇ   ‚îú‚îÄ‚îÄ ‚Üí service_map.py
        ‚îÇ   ‚îú‚îÄ‚îÄ ‚Üí builder.py
        ‚îÇ   ‚îú‚îÄ‚îÄ ‚Üí helpers.py
        ‚îÇ   ‚îú‚îÄ‚îÄ ‚Üí repository.py
        ‚îÇ   ‚îî‚îÄ‚îÄ ‚Üí utils/ (parsers, constants, validators)
        ‚îÇ
        ‚îú‚îÄ‚îÄ builder.py
        ‚îÇ   ‚îú‚îÄ‚îÄ ‚Üí helpers.py
        ‚îÇ   ‚îî‚îÄ‚îÄ ‚Üí utils/
        ‚îÇ
        ‚îú‚îÄ‚îÄ helpers.py
        ‚îÇ   ‚îî‚îÄ‚îÄ ‚Üí utils/
        ‚îÇ
        ‚îú‚îÄ‚îÄ service_map.py
        ‚îÇ   ‚îî‚îÄ‚îÄ ‚Üí utils/
        ‚îÇ
        ‚îî‚îÄ‚îÄ repository.py
            ‚îî‚îÄ‚îÄ models/

calls_service.py
    ‚îî‚îÄ‚îÄ utils/parsers.py

services_service.py
    ‚îî‚îÄ‚îÄ utils/parsers.py
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### ‚úÖ –ß–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å
- –§–∞–π–ª—ã –º–µ–Ω—å—à–µ 300 —Å—Ç—Ä–æ–∫ (–ª–µ–≥–∫–æ —á–∏—Ç–∞—Ç—å)
- –ü–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ –º–æ–¥—É–ª–µ–π
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

### ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å
- –õ–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- –ú–µ–Ω—å—à–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø—Ä–∏ merge

### ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å
- –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
- –ß–µ—Ç–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- –õ–µ–≥–∫–æ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –≤–µ–∑–¥–µ
- –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –¥–ª—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

### –ë—ã–ª–æ (–¥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)
```
app/services/
‚îú‚îÄ‚îÄ compositions_service.py    905 —Å—Ç—Ä–æ–∫  ‚Üê –ú–æ–Ω–æ–ª–∏—Ç!
‚îú‚îÄ‚îÄ calls_service.py           256 —Å—Ç—Ä–æ–∫  ‚Üê –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ parse_datetime, to_string
‚îú‚îÄ‚îÄ services_service.py        702 —Å—Ç—Ä–æ–∫–∏ ‚Üê –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ parse_datetime, to_string
‚îú‚îÄ‚îÄ datasets_service.py         92 —Å—Ç—Ä–æ–∫–∏
‚îî‚îÄ‚îÄ update_service.py          383 —Å—Ç—Ä–æ–∫–∏
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤ 3 —Ñ–∞–π–ª–∞—Ö
- –û–≥—Ä–æ–º–Ω—ã–π —Ñ–∞–π–ª –∫–æ–º–ø–æ–∑–∏—Ü–∏–π (905 —Å—Ç—Ä–æ–∫)
- –°–ª–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
- –ú–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ

### –°—Ç–∞–ª–æ (–ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)
```
app/services/
‚îú‚îÄ‚îÄ compositions_service.py     48 —Å—Ç—Ä–æ–∫  ‚Üê Wrapper
‚îú‚îÄ‚îÄ calls_service.py           213 —Å—Ç—Ä–æ–∫  ‚Üê –ß–∏—â–µ, –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ services_service.py        665 —Å—Ç—Ä–æ–∫  ‚Üê –ß–∏—â–µ, –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ datasets_service.py         92 —Å—Ç—Ä–æ–∫–∏ ‚Üê –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îú‚îÄ‚îÄ update_service.py          383 —Å—Ç—Ä–æ–∫–∏ ‚Üê –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îÇ
‚îú‚îÄ‚îÄ compositions/              ‚Üê –†–∞–∑–±–∏—Ç–æ –Ω–∞ –º–æ–¥—É–ª–∏!
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py             26 —Å—Ç—Ä–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ builder.py             125 —Å—Ç—Ä–æ–∫  ‚Üê –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ helpers.py             100 —Å—Ç—Ä–æ–∫  ‚Üê –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ recovery.py            334 —Å—Ç—Ä–æ–∫–∏ ‚Üê –ê–ª–≥–æ—Ä–∏—Ç–º—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ repository.py          146 —Å—Ç—Ä–æ–∫  ‚Üê –†–∞–±–æ—Ç–∞ —Å –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ service_map.py         120 —Å—Ç—Ä–æ–∫  ‚Üê –ö–∞—Ä—Ç–∞ —Å–≤—è–∑–µ–π
‚îÇ
‚îî‚îÄ‚îÄ utils/                     ‚Üê –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã!
    ‚îú‚îÄ‚îÄ __init__.py              7 —Å—Ç—Ä–æ–∫
    ‚îú‚îÄ‚îÄ constants.py            23 —Å—Ç—Ä–æ–∫–∏ ‚Üê –í—Å–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
    ‚îú‚îÄ‚îÄ parsers.py             100 —Å—Ç—Ä–æ–∫  ‚Üê –ü–∞—Ä—Å–∏–Ω–≥ (–±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è)
    ‚îî‚îÄ‚îÄ validators.py           55 —Å—Ç—Ä–æ–∫  ‚Üê –í–∞–ª–∏–¥–∞—Ü–∏—è
```

**–£–ª—É—á—à–µ–Ω–∏—è:**
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã < 350 —Å—Ç—Ä–æ–∫
- ‚úÖ –ß–µ—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –õ–µ–≥–∫–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –∏ –∏–∑–º–µ–Ω—è—Ç—å –∫–æ–¥
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ò–º–ø–æ—Ä—Ç –∫–æ–º–ø–æ–∑–∏—Ü–∏–π (—Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±)
```python
from app.services import compositions_service

# –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã
await compositions_service.recover(db)
```

### –ò–º–ø–æ—Ä—Ç –∫–æ–º–ø–æ–∑–∏—Ü–∏–π (–Ω–æ–≤—ã–π —Å–ø–æ—Å–æ–±)
```python
from app.services.compositions import recovery, builder

# –ë–æ–ª–µ–µ —è–≤–Ω–æ –∏ —á–∏—Ç–∞–µ–º–æ
await recovery.recover(db)
composition = builder.normalize_composition(nodes, links)
```

### –ò–º–ø–æ—Ä—Ç —É—Ç–∏–ª–∏—Ç
```python
from app.services.utils import parse_datetime, TASK_SUCCEEDED, is_hashable

# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ, –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã
datetime_obj = parse_datetime("2025-10-10 12:52:23")
if status == TASK_SUCCEEDED and is_hashable(value):
    # ...
```

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞

–í—Å–µ —Å—Ç–∞—Ä—ã–µ –∏–º–ø–æ—Ä—Ç—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:

```python
# –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å—Ç–∞—Ä—ã–π –∫–æ–¥)
from app.services.compositions_service import recover

# –≠—Ç–æ —Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–æ–≤—ã–π –∫–æ–¥)  
from app.services.compositions.recovery import recover
```

–ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–µ–Ω—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥!

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –≤ compositions

1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –∫ –∫–∞–∫–æ–º—É –º–æ–¥—É–ª—é –æ–Ω–∞ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è:
   - –†–∞–±–æ—Ç–∞ —Å –ë–î? ‚Üí `repository.py`
   - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–π? ‚Üí `builder.py`
   - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ? ‚Üí `recovery.py`
   - –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è? ‚Üí `helpers.py`

2. –î–æ–±–∞–≤—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –º–æ–¥—É–ª—å

3. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ `__init__.py` –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

4. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–æ–±–∞–≤—å—Ç–µ –≤ `compositions_service.py` –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —É—Ç–∏–ª–∏—Ç—ã

1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ç–∏–ø:
   - –ü–∞—Ä—Å–∏–Ω–≥? ‚Üí `utils/parsers.py`
   - –í–∞–ª–∏–¥–∞—Ü–∏—è? ‚Üí `utils/validators.py`
   - –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞? ‚Üí `utils/constants.py`

2. –î–æ–±–∞–≤—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é/–∫–æ–Ω—Å—Ç–∞–Ω—Ç—É

3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ–∑–¥–µ –≥–¥–µ –Ω—É–∂–Ω–æ

## Best Practices

### ‚úÖ DO
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ type hints
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ (docstrings)
- –•—Ä–∞–Ω–∏—Ç–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ `utils/constants.py`
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `utils/`

### ‚ùå DON'T
- –ù–µ –¥—É–±–ª–∏—Ä—É–π—Ç–µ –∫–æ–¥
- –ù–µ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ñ–∞–π–ª—ã > 400 —Å—Ç—Ä–æ–∫
- –ù–µ —Å–º–µ—à–∏–≤–∞–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –ù–µ –Ω–∞—Ä—É—à–∞–π—Ç–µ –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ **–Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**:
- –ò–º–ø–æ—Ä—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –§—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞–ª–∏—Å—å —Ç–µ–º–∏ –∂–µ
- –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ —Ç–æ–Ω–∫–∏–π —Å–ª–æ–π wrapper'–æ–≤

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º–æ–¥—É–ª–µ–π:

```python
# –¢–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞
from app.services.utils.parsers import parse_datetime
assert parse_datetime("2025-10-10 12:00:00") is not None

# –¢–µ—Å—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–æ–º–ø–æ–∑–∏—Ü–∏–π
from app.services.compositions.builder import normalize_composition
result = normalize_composition(nodes, links)
assert "id" in result
```

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

–í–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. –î–æ–±–∞–≤–∏—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è
2. –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. –î–æ–±–∞–≤–∏—Ç—å type hints –≤–µ–∑–¥–µ
4. –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–Ω–µ—à–Ω–∏–º API
5. –í—ã–Ω–µ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å

